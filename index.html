<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PowerBots360 — Accueil</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; margin:0; padding:0; }
html, body { height:100%; width:100%; font-family:'Poppins', sans-serif; overflow-x:hidden; }
a { color:inherit; text-decoration:none; }
:root{
  --bg-start:#A8D5BA;
  --bg-end:#D1E8FF;
  --text:#043233;
  --id-card-gradient:linear-gradient(135deg,#A8D5BA,#D1E8FF);
}
body{ background:linear-gradient(135deg,var(--bg-start),var(--bg-end)); color:var(--text); }

/* Navbar */
.navbar{position:fixed;top:0;left:0;width:100%;background:var(--id-card-gradient);padding:12px 18px;display:flex;align-items:center;justify-content:space-between;z-index:1000;height:60px;}
.navbar img{height:40px;}
.brand{font-weight:700;font-size:1rem;letter-spacing:0.3px;}

/* Hamburger */
.hamburger{display:flex;flex-direction:column;cursor:pointer;gap:4px;z-index:1100;width:28px;height:22px;}
.hamburger span{width:100%;height:3px;background:var(--text);border-radius:2px;transition:all .3s;}

/* Menu */
.menu{position:fixed;top:60px;right:-200px;width:200px;height:calc(100% - 60px);background:var(--id-card-gradient);padding:12px;display:flex;flex-direction:column;gap:10px;transition:right .3s;z-index:998;overflow-y:auto;}
.menu.open{right:0;}
.menu a{font-weight:600;font-size:.9rem;padding:6px;border-radius:6px;transition:background .2s, transform .1s;}
.menu a:hover{background:rgba(255,255,255,.3);transform:scale(1.03);}

/* ID Card */
.id-card-container{position:fixed;top:60px;left:0;display:flex;flex-direction:column;align-items:flex-start;z-index:1001;}
.toggle-btn{width:28px;height:28px;background:var(--id-card-gradient);border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,.2);display:flex;align-items:center;justify-content:center;cursor:pointer;margin-bottom:6px;transition:all .3s;font-weight:bold;font-size:18px;color:var(--text);}
.toggle-btn:hover{transform:scale(1.1);background:linear-gradient(135deg,#B0E0C2,#E0F0FF);}
.id-card{background:var(--id-card-gradient);padding:12px;border-radius:0 12px 12px 0;font-size:.8rem;display:flex;flex-direction:column;gap:6px;box-shadow:2px 4px 12px rgba(0,0,0,.15);min-width:200px;transform:translateX(-100%);transition:transform .4s;}
.id-card.open{transform:translateX(0);}
.id-card .status{display:flex;align-items:center;gap:6px;}
.status-dot{width:8px;height:8px;border-radius:50%;background:#E53935;transition:background-color .3s;} /* rouge défaut */
.status-dot.online{background:#4CAF50;} /* vert connecté */

/* Bouton connexion (texte harmonisé) */
.logout-btn{margin-top:6px;padding:6px 10px;font-size:.75rem;font-weight:600;color:var(--text);border:none;border-radius:6px;display:flex;align-items:center;justify-content:center;gap:4px;box-shadow:0 2px 8px rgba(0,0,0,.2);cursor:pointer;background:linear-gradient(135deg,#B0E0C2,#E0F0FF);}

/* Contenu */
.content{padding-top:80px;text-align:center;max-width:900px;margin:0 auto;}
.content h1{font-size:2rem;margin-bottom:15px;}
.content p{font-size:1.05rem;max-width:640px;margin:0 auto 25px;line-height:1.5;}
.btn-catalogue{background:var(--id-card-gradient);color:var(--text);padding:12px 24px;font-weight:600;border-radius:6px;cursor:pointer;}
.btn-catalogue:hover{background:linear-gradient(135deg,#B0E0C2,#E0F0FF);}

/* Toast */
.notification{position:fixed;top:70px;right:20px;background:linear-gradient(135deg,#A8D5BA,#D1E8FF);color:var(--text);padding:12px 18px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.2);font-weight:600;display:none;z-index:1200;}
</style>
</head>
<body>

<!-- NAV -->
<div class="navbar">
  <div style="display:flex;align-items:center;gap:10px;">
    <img src="https://i.postimg.cc/vZrnmPXd/IMG-3286.png" alt="Logo PowerBots360">
    <span class="brand">PowerBots360</span>
  </div>
  <div class="hamburger" id="hamburger" aria-label="Ouvrir le menu" tabindex="0">
    <span></span><span></span><span></span>
  </div>
</div>

<!-- ID CARD -->
<div class="id-card-container">
  <div class="toggle-btn" id="toggleBtn" aria-label="Ouvrir la carte" tabindex="0">+</div>
  <div class="id-card" id="idCard">
    <span>Identifiant : <strong id="userName">---</strong></span>
    <span>Solde : <strong id="userBalance">0 €</strong></span>
    <div class="status">
      <span class="status-dot" id="statusDot"></span>
      <span id="userStatus">Hors ligne</span>
    </div>
    <button class="logout-btn" id="loginBtn">Se connecter</button>
  </div>
</div>

<!-- MENU -->
<div class="menu" id="menu" role="menu" aria-hidden="true">
  <a href="index.html">Accueil</a>
  <a href="catalogue.html">Catégorie</a>
  <a href="payment.html">Paiement</a>
  <a href="juridique.html">Juridique</a>
  <a href="bonnespratiques.html">Bonnes Pratiques</a>
  <a href="connexion.html">Connexion</a>
  <a href="inscription.html">Inscription</a>
</div>

<!-- CONTENT -->
<div class="content">
  <h1>Bienvenue sur <strong>PowerBots360</strong></h1>
  <p>Notre plateforme SMM vous offre des <strong>services performants et fiables</strong>, pensés pour maximiser votre impact digital et sécuriser vos résultats sur tous vos réseaux.</p>
  <button class="btn-catalogue" id="catalogBtn" type="button">Voir la catégorie</button>
</div>

<div class="notification" id="toast">Bienvenue !</div>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* === UI Elements === */
  const hamburger   = document.getElementById('hamburger');
  const menu        = document.getElementById('menu');
  const toggleBtn   = document.getElementById('toggleBtn');
  const idCard      = document.getElementById('idCard');
  const catalogBtn  = document.getElementById('catalogBtn');
  const loginBtn    = document.getElementById('loginBtn');
  const userNameEl  = document.getElementById('userName');
  const userStatusEl= document.getElementById('userStatus');
  const statusDot   = document.getElementById('statusDot');
  const balanceEl   = document.getElementById('userBalance');
  const toast       = document.getElementById('toast');

  function showToast(msg){
    toast.textContent = msg;
    toast.style.display = 'block';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => toast.style.display = 'none', 3500);
  }

  // Menu toggle
  if(hamburger && menu){
    const toggleMenu = () => {
      menu.classList.toggle('open');
      menu.setAttribute('aria-hidden', String(!menu.classList.contains('open')));
    };
    hamburger.addEventListener('click', toggleMenu);
    hamburger.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') toggleMenu(); });
  }

  // ID Card toggle
  if(toggleBtn && idCard){
    const toggleCard = () => {
      idCard.classList.toggle('open');
      toggleBtn.textContent = idCard.classList.contains('open') ? '×' : '+';
    };
    toggleBtn.addEventListener('click', toggleCard);
    toggleBtn.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') toggleCard(); });
  }

  // Lien catalogue
  if(catalogBtn){
    catalogBtn.addEventListener('click', () => { window.location.href = 'catalogue.html'; });
  }

  /* === Firebase (compat) === */
  const firebaseConfig = {
    apiKey: "AIzaSyChJoeaMJlj2F-7okhrPJYw868Z1RhgMFY",
    authDomain: "powerbots360-2a163.firebaseapp.com",
    projectId: "powerbots360-2a163",
    storageBucket: "powerbots360-2a163.appspot.com",
    messagingSenderId: "968053928320",
    appId: "1:968053928320:web:c51f7be039c02f2fb69165",
    measurementId: "G-TXSM0JYF1G"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db   = firebase.firestore();

  // Utilitaires
  function niceName(user){
    // affiche displayName si dispo, sinon l'email
    return user.displayName ? user.displayName : (user.email || 'Utilisateur');
  }
  async function ensureUserDoc(user){
    const ref = db.collection('users').doc(user.uid);
    const snap = await ref.get();
    if(!snap.exists){
      await ref.set({
        name: niceName(user),
        balance: 0,
        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
      });
      return { balance: 0 };
    }else{
      // maj lastLogin, renvoie balance
      await ref.update({ lastLogin: firebase.firestore.FieldValue.serverTimestamp() });
      return snap.data();
    }
  }
  function setOnlineUI(user, balance){
    userNameEl.textContent = niceName(user);
    userStatusEl.textContent = "En ligne";
    statusDot.classList.add('online');
    balanceEl.textContent = (typeof balance === 'number' ? balance : 0) + " €";
    loginBtn.textContent = "Se déconnecter";
  }
  function setOfflineUI(){
    userNameEl.textContent = "---";
    userStatusEl.textContent = "Hors ligne";
    statusDot.classList.remove('online');
    balanceEl.textContent = "0 €";
    loginBtn.textContent = "Se connecter";
  }

  // Écoute l'état d'auth
  auth.onAuthStateChanged(async (user) => {
    if(user){
      try{
        const data = await ensureUserDoc(user);
        setOnlineUI(user, data.balance);
        showToast(`Bienvenue ${niceName(user)} !`);
      }catch(e){
        console.error(e);
        setOnlineUI(user, 0);
      }
    }else{
      setOfflineUI();
    }
  });

  // Clic connexion/déconnexion
  if(loginBtn){
    loginBtn.addEventListener('click', async () => {
      if(auth.currentUser){
        // Déconnexion
        try{
          await auth.signOut();
          setOfflineUI();
          showToast("Déconnecté.");
        }catch(e){
          alert("Erreur déconnexion : " + e.message);
        }
      }else{
        // Connexion email+mdp (simple prompt pour aller vite)
        const email = prompt("Email :");
        const password = prompt("Mot de passe :");
        if(!email || !password) return;

        try{
          await auth.signInWithEmailAndPassword(email.trim(), password);
          // onAuthStateChanged fera le reste
        }catch(e){
          if(e.code === 'auth/user-not-found'){
            // Propose de créer le compte
            if(confirm("Utilisateur introuvable. Créer un compte avec cet email ?")){
              try{
                await auth.createUserWithEmailAndPassword(email.trim(), password);
                // onAuthStateChanged gérera l’UI et la création du doc
              }catch(err){
                alert("Création échouée : " + err.message);
              }
            }
          }else{
            alert("Erreur connexion : " + e.message);
          }
        }
      }
    });
  }
});
</script>
</body>
</html>
