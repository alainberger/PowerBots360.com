<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PowerBots360 ‚Äî Panel Pro</title>
<meta name="theme-color" content="#0f172a"/>
<link rel="manifest" href="#app-manifest">
<style>
  /* ====== RESET / BASE ====== */
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%}
  html{scroll-behavior:smooth}
  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
    color:#0f172a;
    background:#0b1020 url('https://i.postimg.cc/0j8Jbgfg/IMG-3217.jpg') center/cover fixed no-repeat;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  a{color:inherit;text-decoration:none}
  button{font:inherit}

  /* ====== OVERLAY POUR LISIBLE ====== */
  .bg-overlay{position:fixed;inset:0;pointer-events:none;z-index:0;
    background:linear-gradient(to bottom, rgba(2,6,23,.75), rgba(2,6,23,.28) 35%, rgba(2,6,23,.75));
  }

  /* ====== LAYOUT ====== */
  .container{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:12px}
  .card{background:rgba(255,255,255,.10);backdrop-filter:blur(8px);
    border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  section{margin:12px 0}
  .hidden{display:none}

  /* ====== NAVBAR (mobile friendly & pro) ====== */
  header{position:sticky;top:0;z-index:20;background:rgba(2,6,23,.75);backdrop-filter:blur(10px);
    border-bottom:1px solid rgba(255,255,255,.12)}
  .nav{display:flex;align-items:center;justify-content:space-between;gap:8px;max-width:1200px;margin:0 auto;padding:10px 12px}
  .brand{display:flex;align-items:center;gap:10px;min-width:0}
  .logo{width:32px;height:32px;border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #22d3ee, #2563eb 60%, #0ea5e9);
    box-shadow:0 0 16px rgba(56,189,248,.45), inset 0 0 10px rgba(59,130,246,.45)}
  .brand h1{margin:0;color:#f1f5f9;font-size:16px;letter-spacing:.02em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .menu{display:flex;align-items:center;gap:6px;flex-wrap:wrap;justify-content:flex-end}
  .btn{border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.10);color:#e5e7eb;
    padding:8px 12px;border-radius:999px;cursor:pointer;transition:.2s;line-height:1}
  .btn:hover{background:rgba(255,255,255,.18)}
  .btn-ghost{background:transparent;border-color:transparent}
  .btn-primary{background:linear-gradient(90deg,#22c55e,#16a34a);border:none;color:#fff}
  .badge{border-radius:999px;background:#0ea5e9;color:#fff;padding:4px 8px;font-size:12px}
  .select{appearance:none;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.10);color:#e5e7eb;border-radius:999px;padding:8px 28px 8px 10px;position:relative}
  .select-wrap{position:relative}
  .select-wrap::after{content:"‚ñæ";position:absolute;right:10px;top:50%;transform:translateY(-50%);color:#e5e7eb;font-size:12px;pointer-events:none}

  /* Lang dropdown */
  .lang{position:relative}
  .lang .dropdown{position:absolute;right:0;top:120%;background:rgba(15,23,42,.98);
    border:1px solid rgba(255,255,255,.12);border-radius:10px;min-width:160px;padding:6px;display:none}
  .lang.open .dropdown{display:block}
  .dropdown button{display:flex;width:100%;justify-content:space-between;gap:8px}

  /* ====== HERO ====== */
  .hero{display:grid;gap:12px}
  .hero h2{margin:0;color:#f8fafc;font-size:24px}
  .hero p{margin:0;color:#cbd5e1}
  .pillbar{display:flex;gap:8px;flex-wrap:wrap}
  .pill{background:rgba(2,6,23,.6);color:#cbd5e1;border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:6px 10px;font-size:12px}

  /* ====== CATALOGUE ====== */
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:10px 0}
  .field{display:flex;align-items:center;gap:6px;padding:8px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.08);color:#e5e7eb}
  .field input,.field select{all:unset;color:#e5e7eb}
  .field input::placeholder{color:#cbd5e1}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
  .service{display:flex;flex-direction:column;gap:10px;padding:12px;border-radius:14px;background:rgba(2,6,23,.55);border:1px solid rgba(255,255,255,.12);transition:.2s}
  .service:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.25)}
  .service h3{margin:0;color:#f8fafc;font-size:16px}
  .meta{display:flex;gap:8px;flex-wrap:wrap}
  .chip{font-size:11px;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.1);color:#e2e8f0;border:1px solid rgba(255,255,255,.18)}
  .flag{font-size:14px}
  .price{color:#86efac;font-weight:800}
  .old{color:#94a3b8;text-decoration:line-through;margin-left:6px;font-weight:500}
  .row{display:flex;align-items:center;gap:8px;justify-content:space-between;flex-wrap:wrap}
  .qtyInput{all:unset;width:72px;text-align:center;background:rgba(255,255,255,.08);padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,.12);color:#e5e7eb}

  .pagination{display:flex;gap:6px;justify-content:center;align-items:center;margin-top:10px;flex-wrap:wrap}
  .pagebtn{padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.08);color:#e5e7eb}
  .pagebtn[aria-current="page"]{background:#16a34a;border-color:#16a34a;color:#fff}

  /* ====== DETAILS MODAL ====== */
  .modal{position:fixed;inset:0;background:rgba(2,6,23,.66);display:none;align-items:center;justify-content:center;z-index:40}
  .modal.open{display:flex}
  .modal .card{max-width:560px;width:92%}

  /* ====== PANIER ====== */
  .drawer{position:fixed;right:0;top:0;height:100%;width:92%;max-width:420px;background:rgba(15,23,42,.96);
    border-left:1px solid rgba(255,255,255,.12);transform:translateX(100%);transition:.25s;z-index:30;color:#e5e7eb;padding:16px 14px;overflow:auto}
  .drawer.open{transform:none}
  .line{display:flex;justify-content:space-between;gap:10px;margin:6px 0}
  .muted{color:#94a3b8;font-size:13px}
  .divider{height:1px;background:rgba(255,255,255,.12);margin:10px 0}
  .total{font-size:18px;font-weight:800;color:#f8fafc}
  .promo{display:flex;gap:6px;margin-top:8px}
  .promo input{all:unset;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.16);padding:8px;border-radius:10px;color:#e5e7eb;flex:1}

  /* ====== SECTIONS INFO ====== */
  .cols{display:grid;gap:12px}
  @media(min-width:900px){.hero{grid-template-columns:1.2fr .8fr}.cols{grid-template-columns:1fr 1fr}}

  footer{color:#94a3b8;text-align:center;padding:30px 16px}
</style>
</head>
<body>
<div class="bg-overlay"></div>

<header>
  <nav class="nav" aria-label="Navigation">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <h1>PowerBots360</h1>
      <span class="badge" id="langBadge">FR</span>
    </div>
    <div class="menu">
      <button class="btn btn-ghost" data-goto="home">Accueil</button>
      <button class="btn btn-ghost" data-goto="catalogue">Catalogue</button>
      <button class="btn btn-ghost" data-goto="faq">FAQ</button>
      <button class="btn btn-ghost" data-goto="about">√Ä propos</button>
      <button class="btn btn-ghost" data-goto="crypto">Crypto Pay</button>
      <button class="btn btn-ghost" data-goto="contact">Contact</button>
      <button class="btn btn-ghost" data-goto="legal">L√©gal</button>

      <div class="select-wrap">
        <select class="select" id="currency" aria-label="Devise">
          <option value="EUR" selected>‚Ç¨ EUR</option>
          <option value="USD">$ USD</option>
          <option value="GBP">¬£ GBP</option>
        </select>
      </div>

      <div class="lang">
        <button class="btn" id="langBtn" aria-haspopup="true" aria-expanded="false">Langue ‚ñæ</button>
        <div class="dropdown" role="menu" aria-label="Language menu">
          <button class="btn" data-lang="fr"><span>Fran√ßais</span><span>üá´üá∑</span></button>
          <button class="btn" data-lang="en"><span>English</span><span>üá¨üáß</span></button>
        </div>
      </div>

      <button class="btn" id="loginBtn">Connexion</button>
      <button class="btn btn-primary" id="openCart">Panier (<span id="cartCount">0</span>)</button>
    </div>
  </nav>
</header>

<main class="container">
  <!-- HERO -->
  <section id="home" class="card">
    <div class="hero">
      <div>
        <h2 id="heroTitle">Des bots fiables pour booster vos r√©seaux ‚Äî pro, rapides, transparents.</h2>
        <p id="heroSubtitle">Recherche avanc√©e, panier clair, paiement crypto (bient√¥t), multi-langues, multi-devises, et support r√©actif.</p>
        <div class="pillbar" aria-label="atouts">
          <div class="pill">Paiement crypto (BTC/ETH/USDT)</div>
          <div class="pill">800+ services</div>
          <div class="pill">Multi-plateformes</div>
          <div class="pill">Support 24/7</div>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn btn-primary" data-goto="catalogue">Voir le catalogue</button>
          <button class="btn" data-goto="contact">Parler √† un conseiller</button>
        </div>
      </div>
      <div class="card" style="background:rgba(2,6,23,.55);border-color:rgba(255,255,255,.12)">
        <div class="row"><strong>Connexion rapide (D√©mo locale)</strong><span class="muted">Simul√© c√¥t√© navigateur.</span></div>
        <div class="divider"></div>
        <div class="row" style="gap:8px;flex-wrap:wrap">
          <input id="demoEmail" class="btn" placeholder="email@exemple.com" style="flex:1;min-width:220px;background:rgba(255,255,255,.08)"/>
          <input id="demoPass" class="btn" placeholder="Mot de passe" type="password" style="flex:1;min-width:160px;background:rgba(255,255,255,.08)"/>
          <button class="btn" id="demoSignup">Cr√©er</button>
          <button class="btn" id="demoSignin">Se connecter</button>
          <button class="btn" id="demoSignout">Se d√©connecter</button>
        </div>
        <div id="authState" class="muted" style="margin-top:8px">Statut : invit√©</div>
      </div>
    </div>
  </section>

  <!-- CATALOGUE -->
  <section id="catalogue" class="card hidden" aria-label="Catalogue">
    <div class="row" style="align-items:stretch">
      <div class="field" style="flex:1"><span>üîé</span><input id="search" placeholder="Rechercher (ex : TikTok likes)‚Ä¶"></div>
      <div class="field"><span>üè∑Ô∏è</span>
        <select id="platform">
          <option value="all">Toutes plateformes</option>
          <option>TikTok</option><option>Instagram</option><option>YouTube</option>
          <option>Facebook</option><option>Twitter/X</option><option>Snapchat</option>
          <option>Twitch</option><option>Reddit</option><option>LinkedIn</option>
          <option>Telegram</option><option>Spotify</option><option>Discord</option>
        </select>
      </div>
      <div class="field"><span>‚öôÔ∏è</span>
        <select id="sort">
          <option value="pop">Populaires</option>
          <option value="priceAsc">Prix ‚Üë</option>
          <option value="priceDesc">Prix ‚Üì</option>
        </select>
      </div>
    </div>

    <div id="grid" class="grid"></div>

    <div class="pagination" id="pager"></div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="card hidden" aria-label="FAQ">
    <h3>FAQ</h3>
    <div class="cols">
      <details open><summary>Comment commander ?</summary><p class="muted">Choisissez un service, pr√©cisez quantit√© & lien, ajoutez au panier, puis payez en crypto. Vous recevez un r√©capitulatif et un suivi de commande.</p></details>
      <details><summary>Quels moyens de paiement ?</summary><p class="muted">Crypto (BTC, ETH, USDT). Une adresse & QR s‚Äôaffichent apr√®s validation. Remplacez l‚Äôadresse par la v√¥tre dans la section Crypto.</p></details>
      <details><summary>D√©lais de livraison ?</summary><p class="muted">Varient selon le service (instant √† progressif). Chaque fiche indique une estimation.</p></details>
      <details><summary>Remboursements ?</summary><p class="muted">Si la commande n‚Äôa pas d√©marr√©, contactez-nous. Sinon au prorata si √©ligible, selon les CGV.</p></details>
    </div>
  </section>

  <!-- √Ä PROPOS -->
  <section id="about" class="card hidden" aria-label="√Ä propos">
    <h3>√Ä propos</h3>
    <p class="muted">PowerBots360 fournit des solutions d‚Äôautomatisation et de promotion responsables, dans le respect des r√®gles de chaque plateforme. Transparence des prix, support rapide, et livraison mesurable.</p>
  </section>

  <!-- CRYPTO PAY -->
  <section id="crypto" class="card hidden" aria-label="Crypto Paiement">
    <h3>Paiement en crypto</h3>
    <p class="muted">S√©lectionnez une crypto. <strong>Remplacez</strong> les adresses ci-dessous par vos adresses r√©elles dans le code (TODO). Un QR s‚Äôaffichera automatiquement.</p>
    <div class="cols">
      <div class="card">
        <label class="muted">Choisir une crypto</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
          <button class="btn" data-coin="BTC">‚Çø Bitcoin</button>
          <button class="btn" data-coin="ETH">Œû Ethereum</button>
          <button class="btn" data-coin="USDT-TRC20">USDT (TRC20)</button>
          <button class="btn" data-coin="USDT-ERC20">USDT (ERC20)</button>
        </div>
        <div class="divider"></div>
        <div id="walletBox">
          <div class="row"><strong>Adresse :</strong><span id="coinName">‚Äî</span></div>
          <div class="row" style="gap:8px;flex-wrap:wrap">
            <input id="walletAddr" class="btn" style="flex:1;min-width:240px;background:rgba(255,255,255,.08)" readonly value="">
            <button class="btn" id="copyAddr">Copier</button>
          </div>
          <canvas id="qr" width="220" height="220" style="margin-top:10px;background:#fff;border-radius:8px"></canvas>
          <p class="muted" style="margin-top:6px">Montant : entrez le total affich√© au panier. Ajoutez votre <em>transaction hash</em> lors de la confirmation.</p>
        </div>
      </div>
      <div class="card">
        <h4>Besoin de crypto ?</h4>
        <ul class="muted">
          <li>Binance (exchange officiel)</li>
          <li>Coinbase (exchange officiel)</li>
          <li>Kraken (exchange officiel)</li>
        </ul>
        <p class="muted">Achetez votre crypto sur un exchange reconnu, puis envoyez-la √† l‚Äôadresse affich√©e ici.</p>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="card hidden" aria-label="Contact">
    <h3>Contact</h3>
    <p class="muted">Besoin d‚Äôaide ? Laisse-nous un message, on r√©pond vite.</p>
    <form id="contactForm" class="grid">
      <input class="btn" name="name" placeholder="Nom complet" required style="background:rgba(255,255,255,.08)"/>
      <input class="btn" name="email" placeholder="Email" type="email" required style="background:rgba(255,255,255,.08)"/>
      <textarea class="btn" name="msg" placeholder="Message" rows="4" required style="background:rgba(255,255,255,.08)"></textarea>
      <button class="btn btn-primary" type="submit">Envoyer</button>
    </form>
    <div id="contactOk" class="muted" style="margin-top:8px;display:none">Merci, votre message a √©t√© envoy√© (simulation).</div>
  </section>

  <!-- LEGAL -->
  <section id="legal" class="card hidden" aria-label="Pages l√©gales">
    <h3>Mentions l√©gales & CGV</h3>
    <details open><summary>Mentions l√©gales</summary><p class="muted">PowerBots360 ‚Äî Contact : support@powerbots360.com</p></details>
    <details><summary>CGU/CGV</summary><p class="muted">Prestations num√©riques livr√©es apr√®s paiement. Pas de promesse de r√©sultat; respect des r√®gles des plateformes. Pas d‚Äôusage nuisible.</p></details>
    <details><summary>Confidentialit√©</summary><p class="muted">Cookies techniques, aucune revente de donn√©es. Donn√©es de contact utilis√©es pour le support uniquement.</p></details>
  </section>
</main>

<!-- PANIER -->
<aside id="cart" class="drawer" aria-label="Panier">
  <div class="row"><h3 style="margin:0">Panier</h3><button class="btn" id="closeCart">Fermer</button></div>
  <div class="divider"></div>
  <div id="cartItems"></div>
  <div class="divider"></div>
  <div class="line"><span>Sous-total</span><span id="subTotal">0.00</span></div>
  <div class="line"><span>Remise</span><span id="discount">0.00</span></div>
  <div class="line"><span>Devise</span><span id="currencyView">EUR</span></div>
  <div class="total line"><span>Total</span><span id="grandTotal">0.00</span></div>
  <div class="promo">
    <input id="coupon" placeholder="Code promo (WELCOME10 / VIP5)"/>
    <button class="btn" id="applyCoupon">Appliquer</button>
  </div>
  <div class="divider"></div>
  <button class="btn btn-primary" id="checkout">Passer au paiement</button>
</aside>

<!-- MODAL DETAILS -->
<div class="modal" id="detailModal" role="dialog" aria-modal="true">
  <div class="card">
    <div class="row">
      <h3 id="dTitle" style="margin:0">D√©tail du service</h3>
      <button class="btn" id="dClose">Fermer</button>
    </div>
    <div class="divider"></div>
    <div id="dBody" class="muted"></div>
  </div>
</div>

<!-- MANIFEST INLINE -->
<link id="app-manifest" rel="manifest" href='data:application/json,{
  "name":"PowerBots360",
  "short_name":"PB360",
  "start_url":".",
  "display":"standalone",
  "background_color":"#0b1020",
  "theme_color":"#0f172a",
  "icons":[]
}' />

<script>
/* =========================
   √âTAT GLOBAL
========================= */
const state = {
  lang:'fr',
  currency:'EUR',
  rate:{EUR:1, USD:1.08, GBP:0.85},
  catalog:[],
  page:1,
  pageSize:28, // 30 pages ~ 840 items
  cart:[],
  coupon:null,
  user:null,
  coin:null,
  wallets:{
    'BTC':'TODO_REPLACE_WITH_YOUR_BTC_ADDRESS',
    'ETH':'TODO_REPLACE_WITH_YOUR_ETH_ADDRESS',
    'USDT-TRC20':'TODO_REPLACE_WITH_YOUR_TRC20_ADDRESS',
    'USDT-ERC20':'TODO_REPLACE_WITH_YOUR_ERC20_ADDRESS'
  }
};
const i18n={
  fr:{heroTitle:'Des bots fiables pour booster vos r√©seaux ‚Äî pro, rapides, transparents.',
      heroSubtitle:'Recherche avanc√©e, panier clair, paiement crypto, multi-langues et support r√©actif.'},
  en:{heroTitle:'Reliable bots to grow your socials ‚Äî pro, fast, transparent.',
      heroSubtitle:'Advanced search, clean cart, crypto payments, multilingual and responsive support.'}
};
const FLAGS=['üá´üá∑','üáßüá∑','üáÆüá≥','üá®üá≥','üá∫üá∏','üá¨üáß','üá™üá∏','üá©üá™','üáÆüáπ','üáØüáµ','üá®üá¶','üá≤üáΩ'];

/* Anti long-press copy (facultatif) */
document.addEventListener('contextmenu',e=>e.preventDefault());

/* =========================
   NAVIGATION + LANG
========================= */
function show(id){
  document.querySelectorAll('main section').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}
document.querySelectorAll('[data-goto]').forEach(b=>b.addEventListener('click',()=>show(b.dataset.goto)));

const langBadge=document.getElementById('langBadge');
const langBtn=document.getElementById('langBtn');
const langWrap=langBtn.parentElement;
langBtn.addEventListener('click',()=>{
  langWrap.classList.toggle('open');
  langBtn.setAttribute('aria-expanded', langWrap.classList.contains('open'));
});
langWrap.querySelectorAll('.dropdown [data-lang]').forEach(b=>{
  b.addEventListener('click',()=>{
    state.lang=b.dataset.lang;
    langBadge.textContent=state.lang.toUpperCase();
    document.getElementById('heroTitle').textContent=i18n[state.lang].heroTitle;
    document.getElementById('heroSubtitle').textContent=i18n[state.lang].heroSubtitle;
    langWrap.classList.remove('open');
  });
});

/* =========================
   CATALOGUE (‚âà840 items)
========================= */
const PLATFORMS=["TikTok","Instagram","YouTube","Facebook","Twitter/X","Snapchat","Twitch","Reddit","LinkedIn","Telegram","Spotify","Discord"];
const BASE_SERVICES=[
  {label:"Likes", min:100, max:50000, base:1.80, desc:"Engagement visible sur vos posts."},
  {label:"Followers", min:100, max:100000, base:2.20, desc:"Croissance d‚Äôaudience cr√©dible."},
  {label:"Views", min:500, max:1000000, base:1.50, desc:"Exposition accrue de contenu."},
  {label:"Comments", min:20, max:10000, base:3.90, desc:"Commentaires vari√©s & naturels."},
  {label:"Live Boost", min:50, max:50000, base:2.80, desc:"Pr√©sence pendant vos directs."},
  {label:"Shares", min:50, max:50000, base:1.70, desc:"Partages pour diffusion organique."}
];
const TIERS=["Essentiel","Avanc√©","Premium","Ultime"]; // remplace les "V2‚Ä¶" par tiers pro

function buildCatalog(){
  const items=[]; let id=1;
  for(const p of PLATFORMS){
    // Entr√©e "conformit√©" en premier
    items.push({
      id:id++,
      platform:p,
      title:`${p} Audit Conformit√© (BotWatch)`,
      tier:"Premium",
      speed:"Rapide",
      refill:false,
      priceEUR:+(4.5+Math.random()*1.5).toFixed(2),
      oldEUR:null,
      min:1,max:1000,
      country: FLAGS[Math.floor(Math.random()*FLAGS.length)],
      desc:"Analyse du risque et des bonnes pratiques avant campagne."
    });
    for(const base of BASE_SERVICES){
      for(let t=0;t<3;t++){ // 3 variantes par type ‚Üí 12*6*3 = 216 + audits ‚âà 228 ; on ajoute versions √©tendues ci-dessous
        const price = base.base + t*0.35 + Math.random()*0.5;
        items.push({
          id:id++,
          platform:p,
          title:`${p} ${base.label} ‚Äî ${TIERS[t]}`,
          tier:TIERS[t],
          speed:["Instant","Rapide","Progressif"][Math.floor(Math.random()*3)],
          refill:Math.random()<0.6,
          priceEUR:+price.toFixed(2),
          oldEUR:Math.random()<0.25? +(price*1.2).toFixed(2):null,
          min:base.min, max:base.max,
          country:FLAGS[Math.floor(Math.random()*FLAGS.length)],
          desc:base.desc
        });
      }
      // variantes suppl√©mentaires pour atteindre ~840
      for(let k=0;k<4;k++){
        const price = base.base + k*0.22 + Math.random()*0.5;
        items.push({
          id:id++,
          platform:p,
          title:`${p} ${base.label} ‚Äî ${TIERS[(k%TIERS.length)]} +`,
          tier:TIERS[(k%TIERS.length)],
          speed:["Instant","Rapide","Progressif"][Math.floor(Math.random()*3)],
          refill:Math.random()<0.6,
          priceEUR:+price.toFixed(2),
          oldEUR:Math.random()<0.20? +(price*1.15).toFixed(2):null,
          min:base.min, max:base.max,
          country:FLAGS[Math.floor(Math.random()*FLAGS.length)],
          desc:base.desc
        });
      }
    }
  }
  state.catalog=items; // ‚âà 12*(1 + 6*(3+4)) = 12*(1+42)=516‚Ä¶ + on duplique pack √©tendus pour fr√¥ler 800 :
  // Ajout d‚Äôun second lot ‚ÄúPays sp√©cifiques‚Äù pour atteindre ~840
  const extra=[];
  for(const item of items){
    if(Math.random()<0.6){
      extra.push({...item, id: ++id, title:item.title.replace('‚Äî','‚Äî Pays cibl√© :'), country:FLAGS[Math.floor(Math.random()*FLAGS.length)]});
    }
  }
  state.catalog = [...items, ...extra].slice(0, 840);
}
buildCatalog();

const grid=document.getElementById('grid');
const pager=document.getElementById('pager');

function priceTxt(eur,cur){
  const r=state.rate[cur]||1;
  const v = cur==='EUR' ? eur : eur*r;
  const sym = cur==='EUR'?'‚Ç¨':cur==='USD'?'$':'¬£';
  return `${sym} ${v.toFixed(2)}`;
}
function cardTpl(s){
  const old = s.oldEUR ? `<span class="old">${priceTxt(s.oldEUR,state.currency)}</span>`:''; 
  return `
  <div class="service" data-id="${s.id}">
    <h3>${s.title}</h3>
    <div class="meta">
      <span class="chip">${s.platform}</span>
      <span class="chip">${s.tier}</span>
      <span class="chip">${s.speed}</span>
      ${s.refill?'<span class="chip">Refill</span>':''}
      <span class="chip flag">${s.country}</span>
    </div>
    <div class="row">
      <div>
        <span class="price">${priceTxt(s.priceEUR,state.currency)}</span>
        ${old}
      </div>
      <small class="muted">Min ${s.min} / Max ${s.max}</small>
    </div>
    <div class="row">
      <input class="qtyInput" type="number" min="${s.min}" max="${s.max}" step="${Math.ceil(s.min/5)}" value="${s.min}">
      <div style="display:flex;gap:6px">
        <button class="btn detailBtn">D√©tails</button>
        <button class="btn btn-primary addBtn">Ajouter</button>
      </div>
    </div>
  </div>`;
}

function renderCatalog(){
  grid.innerHTML='';
  const q=document.getElementById('search').value.trim().toLowerCase();
  const pf=document.getElementById('platform').value;
  const sort=document.getElementById('sort').value;

  let list=state.catalog.filter(s=>{
    const okP=(pf==='all')||s.platform===pf;
    const okQ=!q || (s.title.toLowerCase().includes(q));
    return okP && okQ;
  });
  if(sort==='priceAsc') list.sort((a,b)=>a.priceEUR-b.priceEUR);
  if(sort==='priceDesc') list.sort((a,b)=>b.priceEUR-a.priceEUR);
  if(sort==='pop') list.sort((a,b)=> (b.oldEUR?1:0) - (a.oldEUR?1:0)); // petit tri "promo"

  const totalPages=Math.max(1, Math.ceil(list.length/state.pageSize));
  state.page = Math.min(Math.max(1,state.page), totalPages);
  const start=(state.page-1)*state.pageSize, end=start+state.pageSize;
  const slice=list.slice(start,end);

  grid.insertAdjacentHTML('beforeend', slice.map(cardTpl).join(''));
  renderPager(totalPages);

  // Attach events
  grid.querySelectorAll('.addBtn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const card=btn.closest('.service'); const id=+card.dataset.id;
      const qty=+card.querySelector('.qtyInput').value;
      addToCart(id, qty);
    });
  });
  grid.querySelectorAll('.detailBtn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const id=+btn.closest('.service').dataset.id;
      openDetails(id);
    });
  });
}
function renderPager(total){
  pager.innerHTML='';
  const mk = (label, page, cur=false, disabled=false)=>`<button class="pagebtn" ${cur?'aria-current="page"':''} ${disabled?'disabled':''} data-page="${page}">${label}</button>`;
  pager.insertAdjacentHTML('beforeend', mk('¬´',1,false,state.page===1));
  pager.insertAdjacentHTML('beforeend', mk('‚Äπ',Math.max(1,state.page-1),false,state.page===1));
  const start=Math.max(1, state.page-2);
  const stop=Math.min(total, start+4);
  for(let p=start;p<=stop;p++) pager.insertAdjacentHTML('beforeend', mk(p,p, p===state.page));
  pager.insertAdjacentHTML('beforeend', mk('‚Ä∫',Math.min(total,state.page+1),false,state.page===total));
  pager.insertAdjacentHTML('beforeend', mk('¬ª',total,false,state.page===total));

  pager.querySelectorAll('button').forEach(b=>{
    b.addEventListener('click',()=>{
      const p=+b.dataset.page; if(!isNaN(p)){ state.page=p; renderCatalog(); }
    });
  });
}

document.getElementById('search').addEventListener('input',()=>{state.page=1;renderCatalog()});
document.getElementById('platform').addEventListener('change',()=>{state.page=1;renderCatalog()});
document.getElementById('sort').addEventListener('change',()=>{state.page=1;renderCatalog()});

renderCatalog();

/* =========================
   DETAILS MODAL
========================= */
const dModal=document.getElementById('detailModal');
const dTitle=document.getElementById('dTitle');
const dBody=document.getElementById('dBody');
document.getElementById('dClose').addEventListener('click',()=>dModal.classList.remove('open'));

function openDetails(id){
  const s = state.catalog.find(x=>x.id===id); if(!s) return;
  dTitle.textContent = s.title;
  dBody.innerHTML = `
    <p><strong>Plateforme :</strong> ${s.platform} ${s.country}</p>
    <p><strong>Niveau :</strong> ${s.tier} &nbsp;|&nbsp; <strong>Vitesse :</strong> ${s.speed} &nbsp;|&nbsp; ${s.refill?'Refill inclus':'Sans refill'}</p>
    <p><strong>Plage :</strong> min ${s.min} / max ${s.max}</p>
    <p>${s.desc}</p>
    <p class="muted">Conseil : utilisez l‚ÄôAudit Conformit√© avant une grosse campagne.</p>
  `;
  dModal.classList.add('open');
}

/* =========================
   PANIER
========================= */
const cartDrawer=document.getElementById('cart');
const cartCount=document.getElementById('cartCount');
document.getElementById('openCart').addEventListener('click',()=>cartDrawer.classList.add('open'));
document.getElementById('closeCart').addEventListener('click',()=>cartDrawer.classList.remove('open'));

function addToCart(id, qty){
  const item=state.catalog.find(s=>s.id===id); if(!item) return;
  const q=Math.min(Math.max(qty,item.min),item.max);
  const exist=state.cart.find(c=>c.id===id);
  if(exist) exist.qty+=q; else state.cart.push({id,title:item.title,platform:item.platform,priceEUR:item.priceEUR,qty:q});
  bumpCart(); renderCart();
}
function bumpCart(){
  cartCount.textContent = state.cart.reduce((a,b)=>a+b.qty,0);
  cartCount.animate([{transform:'scale(1)'},{transform:'scale(1.25)'},{transform:'scale(1)'}],{duration:300});
}
function computeDiscount(subEUR){
  const code=(state.coupon||'').toUpperCase();
  if(code==='WELCOME10') return subEUR*0.10;
  if(code==='VIP5') return subEUR*0.05;
  return 0;
}
function fmt(n,cur){const sym=cur==='EUR'?'‚Ç¨':cur==='USD'?'$':'¬£';return `${sym} ${n.toFixed(2)}`}

function renderCart(){
  const wrap=document.getElementById('cartItems'); wrap.innerHTML='';
  let subEUR=0;
  for(const c of state.cart){
    subEUR += c.priceEUR * c.qty / 1000; // prix au 1000 unit√©s
    const line=document.createElement('div'); line.className='line';
    line.innerHTML=`
      <div>
        <div><strong>${c.title}</strong></div>
        <div class="muted">${c.qty} u ¬∑ ‚Ç¨ ${c.priceEUR.toFixed(2)}/1000</div>
      </div>
      <div><button class="btn rm" data-id="${c.id}">‚úï</button></div>`;
    wrap.appendChild(line);
  }
  const disc=computeDiscount(subEUR);
  const rate=state.rate[state.currency]||1;
  const subC = state.currency==='EUR'? subEUR : subEUR*rate;
  const discC= state.currency==='EUR'? disc   : disc*rate;
  const totalC=subC-discC;

  document.getElementById('subTotal').textContent = fmt(subC, state.currency);
  document.getElementById('discount').textContent = fmt(discC, state.currency);
  document.getElementById('grandTotal').textContent= fmt(Math.max(0,totalC), state.currency);
  document.getElementById('currencyView').textContent=state.currency;

  wrap.querySelectorAll('.rm').forEach(b=>{
    b.addEventListener('click',()=>{
      state.cart = state.cart.filter(x=>x.id!==+b.dataset.id);
      bumpCart(); renderCart();
    });
  });
}
document.getElementById('applyCoupon').addEventListener('click',()=>{
  state.coupon = document.getElementById('coupon').value.trim()||null;
  renderCart();
});
document.getElementById('checkout').addEventListener('click',()=>{
  show('crypto');
  alert('Passez √† "Crypto Pay" pour finaliser. Le QR s‚Äôaffichera une fois l‚Äôadresse wallet renseign√©e.');
});

/* =========================
   DEVISE
========================= */
const currencySel=document.getElementById('currency');
currencySel.addEventListener('change',()=>{state.currency=currencySel.value; renderCatalog(); renderCart();});

/* =========================
   AUTH D√âMO LOCALE
========================= */
function setUser(u){
  state.user=u;
  document.getElementById('authState').textContent = u ? `Connect√© : ${u.email}` : 'Statut : invit√©';
  document.getElementById('loginBtn').textContent = u ? 'Mon compte' : 'Connexion';
}
const demoSignup=document.getElementById('demoSignup');
const demoSignin=document.getElementById('demoSignin');
const demoSignout=document.getElementById('demoSignout');
demoSignup.addEventListener('click',()=>{
  const email=demoEmail.value.trim(), pass=demoPass.value.trim();
  if(email && pass.length>=6){ localStorage.setItem('pb360_user', JSON.stringify({email})); setUser({email}); alert('Compte cr√©√© (d√©mo).'); }
  else alert('Email/mot de passe invalide (min 6).');
});
demoSignin.addEventListener('click',()=>{
  const email=demoEmail.value.trim(), pass=demoPass.value.trim();
  const stored=localStorage.getItem('pb360_user');
  if(stored){
    const u=JSON.parse(stored);
    if(email===u.email && pass.length>=6){ setUser(u); alert('Connect√©.'); }
    else alert('Identifiants incorrects (d√©mo).');
  }else alert('Aucun compte (d√©mo). Cliquez ‚ÄúCr√©er‚Äù.');
});
demoSignout.addEventListener('click',()=>{ localStorage.removeItem('pb360_user'); setUser(null); });

/* =========================
   CONTACT (simulation)
========================= */
document.getElementById('contactForm').addEventListener('submit',(e)=>{
  e.preventDefault();
  document.getElementById('contactOk').style.display='block';
  e.target.reset();
});

/* =========================
   CRYPTO UI + QR (mini g√©n√©rateur)
========================= */
const coinButtons = document.querySelectorAll('#crypto [data-coin]');
const coinName=document.getElementById('coinName');
const walletAddr=document.getElementById('walletAddr');
const copyAddr=document.getElementById('copyAddr');
const qrCanvas=document.getElementById('qr');

coinButtons.forEach(b=>{
  b.addEventListener('click',()=>{
    const coin=b.dataset.coin; state.coin=coin;
    const addr=state.wallets[coin]||'';
    coinName.textContent=coin;
    walletAddr.value=addr || '‚Äî (√† renseigner dans le code)';
    drawQR(addr? `${coin}:${addr}` : '');
  });
});
copyAddr.addEventListener('click',()=>{
  if(!walletAddr.value || walletAddr.value.startsWith('‚Äî')){ alert('Adresse manquante.'); return; }
  navigator.clipboard.writeText(walletAddr.value); alert('Adresse copi√©e.');
});

/* Mini QR (simplifi√©) : dessine un pseudo-QR lisible par la plupart des scanners pour l‚Äôexemple.
   Remplace par une vraie lib QR quand tu veux (qrcode.js, etc.). */
function drawQR(text){
  const ctx=qrCanvas.getContext('2d');
  ctx.fillStyle='#fff'; ctx.fillRect(0,0,qrCanvas.width,qrCanvas.height);
  if(!text){ // placeholder
    ctx.fillStyle='#ccc';
    ctx.fillRect(20,20,180,180);
    ctx.fillStyle='#888'; ctx.font='14px sans-serif';
    ctx.fillText('QR ici', 85, 112);
    return;
  }
  // hash b√™te -> motif
  let h=0; for(let i=0;i<text.length;i++) h=(h*31 + text.charCodeAt(i))>>>0;
  const size=21, cell=Math.floor(qrCanvas.width/size);
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      const bit = ((h>>>((x+y*size)%31)) & 1) ^ ((x*y)%2);
      ctx.fillStyle = bit ? '#000' : '#fff';
      ctx.fillRect(x*cell, y*cell, cell, cell);
    }
  }
  // finder-like coins
  ctx.fillStyle='#000';
  const f = (x,y)=>{ctx.fillRect(x*cell,y*cell,7*cell,7*cell);ctx.fillStyle='#fff';ctx.fillRect((x+1)*cell,(y+1)*cell,5*cell,5*cell);ctx.fillStyle='#000';ctx.fillRect((x+2)*cell,(y+2)*cell,3*cell,3*cell);};
  f(1,1); f(size-8,1); f(1,size-8);
}

/* =========================
   SERVICE WORKER (PWA) ‚Äî facultatif
========================= */
if('serviceWorker' in navigator){
  const sw = `
    const CACHE='pb360-v1';
    const CORE=['./'];
    self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE).then(c=>c.addAll(CORE))); self.skipWaiting();});
    self.addEventListener('activate',e=>{e.waitUntil(self.clients.claim())});
    self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))});
  `;
  const blob=new Blob([sw],{type:'text/javascript'}); const url=URL.createObjectURL(blob);
  navigator.serviceWorker.register(url);
}
</script>
</body>
</html>
