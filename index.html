<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PowerBots360 ‚Äî Catalogue + Panier + Connexion</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:url('https://i.postimg.cc/0j8Jbgfg/IMG-3217.jpg');
    --glass: rgba(255,255,255,.08);
    --glass-strong: rgba(255,255,255,.14);
    --text:#f8fafc;
    --muted:#cbd5e1;
    --brand:#60a5fa;
    --brand-2:#22d3ee;
    --ok:#34d399;
    --warn:#fbbf24;
    --err:#f87171;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --blur: blur(14px);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font-family:Inter,Manrope,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background: #0b1020 fixed no-repeat center/cover;
  }
  body::before{
    content:""; position:fixed; inset:0;
    background:
      radial-gradient(80% 60% at 20% 10%, rgba(96,165,250,.28), transparent 60%),
      radial-gradient(70% 60% at 90% 40%, rgba(34,211,238,.22), transparent 60%),
      linear-gradient(180deg, rgba(2,6,23,.85), rgba(2,6,23,.85));
    z-index:0;
  }
  body::after{
    content:""; position:fixed; inset:0; z-index:-1;
    background-image: var(--bg); background-size:cover; background-position:center;
    filter: saturate(1.1) contrast(1.05) brightness(.9);
    transform: translateZ(0);
  }
  a{color:inherit; text-decoration:none}
  .wrap{position:relative; z-index:1; min-height:100%}

  /* Navbar */
  .nav{
    position:sticky; top:0; z-index:10;
    display:flex; gap:.5rem; align-items:center; justify-content:space-between;
    padding:.75rem 1rem; backdrop-filter:var(--blur);
    background:linear-gradient(180deg, rgba(15,23,42,.85), rgba(15,23,42,.55));
    border-bottom:1px solid rgba(148,163,184,.2);
  }
  .brand{
    display:flex; align-items:center; gap:.6rem; font-weight:800; letter-spacing:.2px;
    font-size:1.1rem;
  }
  .brand .dot{width:.7rem; height:.7rem; border-radius:50%; background:linear-gradient(45deg,var(--brand),var(--brand-2)); box-shadow:0 0 14px rgba(96,165,250,.8)}
  .nav-right{display:flex; gap:.5rem; align-items:center}
  .btn{
    appearance:none; border:0; border-radius:999px; padding:.6rem .95rem; cursor:pointer;
    background:linear-gradient(90deg, rgba(96,165,250,.2), rgba(34,211,238,.2));
    color:var(--text); box-shadow:var(--shadow); transition:.2s ease;
  }
  .btn:hover{transform:translateY(-1px); background:linear-gradient(90deg, rgba(96,165,250,.3), rgba(34,211,238,.3))}
  .btn.primary{background:linear-gradient(90deg, #3b82f6, #06b6d4)}
  .btn.primary:hover{filter:saturate(1.05) brightness(1.05)}
  .icon-btn{padding:.55rem .7rem; border:1px solid rgba(148,163,184,.25); background:rgba(2,6,23,.35)}
  .pill{display:inline-flex; gap:.5rem; align-items:center; padding:.4rem .7rem; border-radius:999px; background:rgba(148,163,184,.15); border:1px solid rgba(148,163,184,.25); font-size:.85rem}

  /* Panels */
  .section{max-width:1200px; margin: 1.2rem auto; padding:0 1rem}
  .hero{
    margin-top:1.2rem; display:grid; gap:1rem; grid-template-columns:1.2fr .8fr;
  }
  .card{
    background:rgba(2,6,23,.55); border:1px solid rgba(148,163,184,.25); border-radius:16px;
    backdrop-filter: var(--blur); box-shadow: var(--shadow); padding:1rem;
  }
  .title{font-size: clamp(1.2rem, 1.2rem + 1vw, 2rem); font-weight:800; letter-spacing:.2px}
  .muted{color:var(--muted)}
  .grid{display:grid; gap:1rem}
  .grid.cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}
  .grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  @media (max-width: 980px){
    .hero{grid-template-columns:1fr}
    .grid.cols-4{grid-template-columns:repeat(2,minmax(0,1fr))}
  }
  @media (max-width: 640px){
    .grid.cols-3,.grid.cols-4{grid-template-columns:1fr}
  }

  /* Catalogue header */
  .cat-bar{display:flex; flex-wrap:wrap; gap:.6rem; align-items:center; justify-content:space-between; margin-bottom:.5rem}
  .controls{display:flex; flex-wrap:wrap; gap:.6rem; align-items:center}
  .input, select{
    background:rgba(2,6,23,.4); color:var(--text); border:1px solid rgba(148,163,184,.25);
    border-radius:10px; padding:.6rem .75rem; outline:none;
  }
  .input::placeholder{color:#94a3b8}
  .badge{font-size:.78rem; opacity:.85}
  .flag{margin-right:.35rem}

  /* Service card */
  .svc{
    position:relative; border-radius:14px; padding: .9rem; background:rgba(15,23,42,.6);
    border:1px solid rgba(148,163,184,.25); display:flex; flex-direction:column; gap:.55rem;
  }
  .svc .row{display:flex; align-items:center; justify-content:space-between; gap:.6rem}
  .svc .name{font-weight:700}
  .svc .platform{font-size:.85rem; opacity:.85}
  .price{font-weight:800}
  .qty{width:92px}
  .svc .add{display:flex; gap:.5rem; align-items:center}
  .svc .tag{font-size:.72rem; padding:.25rem .5rem; border-radius:999px; background:rgba(99,102,241,.2); border:1px solid rgba(99,102,241,.35)}

  /* Pagination */
  .pager{display:flex; gap:.35rem; align-items:center; justify-content:center; margin-top:.5rem; flex-wrap:wrap}
  .page-btn{
    min-width:40px; text-align:center; padding:.5rem .7rem; border-radius:10px; border:1px solid rgba(148,163,184,.25);
    background:rgba(2,6,23,.35); cursor:pointer;
  }
  .page-btn[aria-current="page"]{background:linear-gradient(90deg,#3b82f6,#06b6d4); border-color:transparent; font-weight:800}

  /* Modals */
  dialog{
    max-width: 860px; width:clamp(320px, 96vw, 860px);
    border:1px solid rgba(148,163,184,.25); border-radius:16px; padding:0; background:rgba(2,6,23,.9);
    color:var(--text);
  }
  dialog::backdrop{background:rgba(2,6,23,.6); backdrop-filter: blur(4px)}
  .modal-head{display:flex; justify-content:space-between; align-items:center; padding: .9rem 1rem; border-bottom:1px solid rgba(148,163,184,.25)}
  .modal-body{padding: 1rem}
  .close{background:transparent; border:0; color:var(--muted); font-size:1.2rem; cursor:pointer}
  .cart-row{display:grid; grid-template-columns: 1.4fr .7fr .7fr .6fr auto; gap:.6rem; padding:.5rem 0; align-items:center; border-bottom:1px dashed rgba(148,163,184,.2)}
  .right{margin-left:auto}
  .total{font-weight:800; font-size:1.15rem}

  /* Auth mini */
  .auth-bar{display:flex; gap:.5rem; align-items:center; flex-wrap:wrap}
  .avatar{width:30px; height:30px; border-radius:50%; background:#111827; display:inline-flex; align-items:center; justify-content:center; font-size:.85rem}

  /* Toast */
  .toast{
    position: fixed; left:50%; transform:translateX(-50%); bottom:18px; z-index:50; display:none;
    background: rgba(17,24,39,.92); border:1px solid rgba(148,163,184,.25); border-radius:12px; padding:.65rem .9rem; box-shadow: var(--shadow);
  }

  /* Links & utility */
  .link{color:#93c5fd; text-decoration:underline}
  .hidden{display:none !important}
</style>
</head>
<body>
<div class="wrap">

  <!-- NAV -->
  <header class="nav">
    <div class="brand">
      <span class="dot"></span> PowerBots360
      <span class="pill" title="S√©curit√© & Paiement">Trusted ‚Ä¢ SSL ‚Ä¢ PayPal</span>
    </div>
    <nav class="nav-right">
      <button id="homeBtn" class="btn icon-btn" title="Accueil">üè†</button>
      <button id="catalogBtn" class="btn icon-btn" title="Catalogue">üìö</button>
      <button id="cartBtn" class="btn icon-btn" title="Panier">üõí <span id="cartCount" class="badge">(0)</span></button>
      <div class="auth-bar">
        <span id="userInfo" class="pill hidden"><span class="avatar" id="avatar">üë§</span><span id="userEmail">‚Äî</span></span>
        <button id="loginBtn" class="btn">Se connecter</button>
        <button id="logoutBtn" class="btn hidden">Se d√©connecter</button>
      </div>
    </nav>
  </header>

  <!-- HERO / HOME -->
  <main id="home" class="section">
    <section class="hero">
      <div class="card">
        <h1 class="title">Boostez vos r√©seaux avec √©l√©gance</h1>
        <p class="muted">Un √©cosyst√®me complet : <b>650+ services</b> tri√©s par plateforme, un <b>panier s√©curis√©</b>, et un <b>paiement PayPal</b> instantan√©. Connexion/Inscription via <b>Firebase</b> (e-mail + Google). Design optimis√© mobile, fond d‚Äô√©cran dynamique et performances fluides.</p>
        <div class="grid cols-2" style="margin-top:.6rem">
          <button class="btn primary" id="goToCatalog">Explorer le catalogue</button>
          <a class="btn" href="#faq">Voir la FAQ</a>
        </div>
      </div>
      <div class="card grid cols-2">
        <div>
          <div class="title" style="font-size:1.1rem">S√©lection rapide</div>
          <div class="muted">Choisissez une plateforme pour commencer :</div>
        </div>
        <div class="grid cols-2">
          <button class="btn" data-quick="TikTok">TikTok</button>
          <button class="btn" data-quick="Instagram">Instagram</button>
          <button class="btn" data-quick="YouTube">YouTube</button>
          <button class="btn" data-quick="Telegram">Telegram</button>
        </div>
      </div>
    </section>
  </main>

  <!-- CATALOG -->
  <section id="catalog" class="section hidden">
    <div class="card">
      <div class="cat-bar">
        <div class="controls">
          <input id="search" class="input" placeholder="Rechercher un service‚Ä¶" />
          <select id="platform">
            <option value="">Toutes plateformes</option>
          </select>
          <select id="country">
            <option value="">Tous pays</option>
          </select>
          <select id="perPage">
            <option>24</option><option>36</option><option selected>48</option><option>60</option>
          </select>
          <span class="badge">par page</span>
        </div>
        <div class="controls">
          <select id="currency">
            <option value="EUR" selected>‚Ç¨ EUR</option>
            <option value="USD">$ USD</option>
            <option value="GBP">¬£ GBP</option>
          </select>
          <button class="btn icon-btn" id="resetFilters">R√©initialiser</button>
        </div>
      </div>

      <div id="services" class="grid cols-4" aria-live="polite"></div>
      <div id="pagination" class="pager"></div>
    </div>
  </section>

  <!-- CART MODAL -->
  <dialog id="cartModal">
    <div class="modal-head">
      <div class="title" style="font-size:1.2rem">Votre panier</div>
      <button class="close" data-close>‚úï</button>
    </div>
    <div class="modal-body">
      <div id="cartItems"></div>
      <div class="row" style="display:flex; gap:.6rem; align-items:center; justify-content:space-between; margin-top:.8rem">
        <div class="muted">Prix affich√©s en <span id="currencyLabel">EUR</span>. Paiement par PayPal s√©curis√©.</div>
        <div class="total">Total : <span id="cartTotal">0.00</span> <span id="cartCur">EUR</span></div>
      </div>
      <div class="row" style="display:flex; gap:.6rem; justify-content:flex-end; margin-top:1rem">
        <button class="btn" data-close>Continuer mes achats</button>
        <button class="btn primary" id="checkoutBtn">Payer maintenant</button>
      </div>
    </div>
  </dialog>

  <!-- AUTH MODAL -->
  <dialog id="authModal">
    <div class="modal-head">
      <div class="title" style="font-size:1.2rem">Connexion / Inscription</div>
      <button class="close" data-close>‚úï</button>
    </div>
    <div class="modal-body">
      <div class="grid cols-2">
        <div>
          <label>Email</label>
          <input id="authEmail" class="input" type="email" placeholder="vous@domaine.com" />
        </div>
        <div>
          <label>Mot de passe</label>
          <input id="authPass" class="input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
      </div>
      <div style="display:flex; gap:.6rem; flex-wrap:wrap; margin-top:.8rem">
        <button class="btn primary" id="doLogin">Se connecter</button>
        <button class="btn" id="doRegister">Cr√©er un compte</button>
        <button class="btn icon-btn" id="doGoogle">Continuer avec Google</button>
      </div>
      <p class="muted" style="margin-top:.8rem">Vos donn√©es d‚Äôauthentification sont g√©r√©es par Firebase (Google). D√©connexion possible √† tout moment.</p>
    </div>
  </dialog>

  <!-- TOAST -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- FAQ (ancre simple) -->
  <section id="faq" class="section">
    <div class="card">
      <div class="title">FAQ</div>
      <details><summary>Comment payer ?</summary><p>Ajoutez vos services au panier, confirmez, puis cliquez ‚ÄúPayer maintenant‚Äù. Vous serez redirig√© vers PayPal (lien PayPal.me/BotMarketPlus) avec le montant exact.</p></details>
      <details><summary>Je peux me connecter avec Google ?</summary><p>Oui. Ouvrez le menu ‚ÄúSe connecter‚Äù et utilisez ‚ÄúContinuer avec Google‚Äù.</p></details>
      <details><summary>Les prix sont-ils en EUR ?</summary><p>Oui, les paiements se font en EUR. Vous pouvez consulter le total dans d‚Äôautres devises √† titre indicatif.</p></details>
    </div>
  </section>

</div>

<!-- APP -->
<script type="module">
/* =========================
   Firebase (v10 modular)
   ========================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import {
  getAuth, onAuthStateChanged,
  signInWithEmailAndPassword, createUserWithEmailAndPassword,
  GoogleAuthProvider, signInWithPopup, signOut
} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

// üëâ Config fournie par toi (remplace si tu changes de projet)
const firebaseConfig = {
  apiKey: "AIzaSyDXccU8CrvsLsNRN2xwAoswyJaapJpS6Do",
  authDomain: "powerbots360.firebaseapp.com",
  projectId: "powerbots360",
  storageBucket: "powerbots360.firebasestorage.app",
  messagingSenderId: "676854068382",
  appId: "1:676854068382:web:4a7b40a5241b022471b78f"
};

let app, auth;
try {
  app = initializeApp(firebaseConfig);
  auth = getAuth(app);
} catch(e){
  console.warn("Firebase init warning:", e);
}

/* =========================
   DOM refs
   ========================= */
const home        = document.getElementById('home');
const catalogSec  = document.getElementById('catalog');
const goToCatalog = document.getElementById('goToCatalog');
const catalogBtn  = document.getElementById('catalogBtn');
const homeBtn     = document.getElementById('homeBtn');
const cartBtn     = document.getElementById('cartBtn');
const cartCount   = document.getElementById('cartCount');
const cartModal   = document.getElementById('cartModal');
const authModal   = document.getElementById('authModal');
const checkoutBtn = document.getElementById('checkoutBtn');
const toastEl     = document.getElementById('toast');

const search   = document.getElementById('search');
const platform = document.getElementById('platform');
const country  = document.getElementById('country');
const perPage  = document.getElementById('perPage');
const servicesEl = document.getElementById('services');
const paginationEl = document.getElementById('pagination');
const currencySel = document.getElementById('currency');
const currencyLabel = document.getElementById('currencyLabel');

const loginBtn = document.getElementById('loginBtn');
const logoutBtn= document.getElementById('logoutBtn');
const userInfo = document.getElementById('userInfo');
const userEmail= document.getElementById('userEmail');
const avatar   = document.getElementById('avatar');

const doLogin = document.getElementById('doLogin');
const doRegister = document.getElementById('doRegister');
const doGoogle = document.getElementById('doGoogle');
const authEmail = document.getElementById('authEmail');
const authPass  = document.getElementById('authPass');

/* =========================
   Utils
   ========================= */
const flags = {
  "FR":"üá´üá∑","US":"üá∫üá∏","GB":"üá¨üáß","DE":"üá©üá™","BR":"üáßüá∑","ES":"üá™üá∏",
  "IT":"üáÆüáπ","IN":"üáÆüá≥","TR":"üáπüá∑","ID":"üáÆüá©","MX":"üá≤üáΩ","JP":"üáØüáµ",
  "KR":"üá∞üá∑","SA":"üá∏üá¶","AE":"üá¶üá™","CA":"üá®üá¶"
};
const platforms = ["Instagram","TikTok","YouTube","Twitter/X","Facebook","Twitch","Snapchat","Telegram","LinkedIn","Pinterest","Reddit","Spotify","SoundCloud"];
const currencyRates = { EUR:1, USD:1.09, GBP:0.85 }; // indicatif, affichage uniquement

function fmt(n){ return (Math.round(n*100)/100).toFixed(2); }
function showToast(msg){
  toastEl.textContent = msg; toastEl.style.display='block';
  clearTimeout(showToast.t); showToast.t=setTimeout(()=>toastEl.style.display='none', 2000);
}
function openModal(d){ if(!d.open) d.showModal(); }
function closeModal(d){ if(d.open) d.close(); }
document.querySelectorAll('[data-close]').forEach(btn=>btn.addEventListener('click', e=>{
  closeModal(btn.closest('dialog'));
}));

/* =========================
   Data generator (650+)
   ========================= */
const countryCodes = Object.keys(flags);
const baseMatrix = {
  "Instagram": { base:3.8, items:["Followers","Likes","Views","Comments","Story Views","Reels Views","Saves","Shares","Auto-Likes"] },
  "TikTok":    { base:2.9, items:["Followers","Likes","Views","Comments","Live Viewers","Shares","Saves","Favorites","Auto-Likes"] },
  "YouTube":   { base:4.5, items:["Subscribers","Likes","Views","Comments","Watch Hours","Live Viewers","Shorts Views","Impressions"] },
  "Twitter/X": { base:3.2, items:["Followers","Likes","Views","Comments","Retweets","Bookmarks","Impressions","Spaces Listeners"] },
  "Facebook":  { base:3.4, items:["Followers","Likes","Views","Comments","Shares","Group Members","Live Viewers"] },
  "Twitch":    { base:4.1, items:["Followers","Live Viewers","Chat Activity","Clips Views","Channel Points"] },
  "Snapchat":  { base:3.6, items:["Followers","Story Views","AR Lens Views","Shares"] },
  "Telegram":  { base:2.7, items:["Channel Members","Post Views","Reactions","Comments","Forwards"] },
  "LinkedIn":  { base:5.1, items:["Followers","Post Views","Reactions","Comments","Shares","Profile Views"] },
  "Pinterest": { base:3.0, items:["Followers","Pin Saves","Impressions","Clicks"] },
  "Reddit":    { base:3.3, items:["Upvotes","Comments","Karma","Subscribers"] },
  "Spotify":   { base:5.4, items:["Followers","Playlist Saves","Streams","Monthly Listeners"] },
  "SoundCloud":{ base:3.1, items:["Followers","Reposts","Likes","Plays","Comments"] }
};

let SERVICES = [];
let idSeq = 1;

for (const p of platforms){
  // Bot ‚Äúmise en avant‚Äù
  SERVICES.push({
    id:idSeq++,
    name:`BOTWATCH ‚Ä¢ ${p} ‚Äî D√©tection contenu non conforme`,
    platform:p,
    country: countryCodes[idSeq % countryCodes.length],
    pricePerK: baseMatrix[p].base * 1.6 * 0.92,
    min:100, max:50000,
    eta:"Temps r√©el",
    desc:"Outil pro de signalement & qualit√© ‚Äî v√©rifie et alerte en amont; conforme aux CGU."
  });

  const conf = baseMatrix[p];
  for (let tier=1;tier<=5;tier++){
    for (const item of conf.items){
      // 5*items ‚âà entre 25 et 45 par plateforme
      const price = (conf.base + tier*0.6) * (1 + (item.length%3)*0.08) * 0.92; // ~8% moins cher
      SERVICES.push({
        id:idSeq++,
        name:`${item} ${["Starter","Smart","Turbo","Pro","Elite"][tier-1]}`,
        platform:p,
        country: countryCodes[(idSeq+item.length) % countryCodes.length],
        pricePerK: price,
        min: (item.includes("Live")||item.includes("Watch"))?50:100,
        max: 100000,
        eta: (item.includes("Live")||item.includes("Watch"))? "Rapide" : "Progressif",
        desc:`${item} ${["qualit√© standard","ciblage intelligent","vitesse √©lev√©e","premium","haut de gamme"][tier-1]} sur ${p}.`
      });
    }
  }
}
// On d√©passe 650 services
// Remplir filtres platform/country
platforms.forEach(pl=>{
  const opt = document.createElement('option'); opt.value=pl; opt.textContent=pl; platform.appendChild(opt);
});
for (const cc of countryCodes){
  const opt = document.createElement('option'); opt.value=cc; opt.textContent=`${flags[cc]} ${cc}`; country.appendChild(opt);
}

/* =========================
   Catalogue + pagination
   ========================= */
let state = { q:"", p:"", c:"", page:1, per: Number(perPage.value), cur:"EUR" };

function applyFilters(){
  let list = SERVICES;
  if (state.q){
    const q = state.q.toLowerCase();
    list = list.filter(s => s.name.toLowerCase().includes(q) || s.platform.toLowerCase().includes(q));
  }
  if (state.p) list = list.filter(s=>s.platform===state.p);
  if (state.c) list = list.filter(s=>s.country===state.c);
  return list;
}
function render(){
  const list = applyFilters();
  const total = list.length;
  const start = (state.page-1)*state.per;
  const slice = list.slice(start, start+state.per);

  servicesEl.innerHTML = slice.map(svc=>{
    const price = convert(svc.pricePerK);
    return `
      <div class="svc">
        <div class="row">
          <div>
            <div class="name">${svc.name}</div>
            <div class="platform muted">${svc.platform} ‚Ä¢ <span class="flag">${flags[svc.country]||""}</span>${svc.country} ‚Ä¢ Min ${svc.min} ‚Ä¢ Max ${svc.max} ‚Ä¢ ${svc.eta}</div>
          </div>
          <div class="price">${fmt(price) } ${state.cur}/1k</div>
        </div>
        <div class="muted">${svc.desc}</div>
        <div class="row">
          <div class="add">
            <input class="input qty" type="number" min="${svc.min}" max="${svc.max}" value="${svc.min}" aria-label="Quantit√©">
            <button class="btn primary addBtn" data-id="${svc.id}">Ajouter</button>
          </div>
          <span class="tag">${svc.platform}</span>
        </div>
      </div>
    `;
  }).join('');

  // Pagination
  const pages = Math.max(1, Math.ceil(total/state.per));
  const maxButtons = 9;
  let first = Math.max(1, state.page - Math.floor(maxButtons/2));
  let last  = Math.min(pages, first + maxButtons - 1);
  first = Math.max(1, last - maxButtons + 1);

  let html = `<button class="page-btn" data-nav="prev" ${state.page===1?'disabled':''}>Pr√©c√©dent</button>`;
  for (let i=first;i<=last;i++){
    html += `<button class="page-btn" data-page="${i}" ${i===state.page?'aria-current="page"':''}>${i}</button>`;
  }
  html += `<button class="page-btn" data-nav="next" ${state.page===pages?'disabled':''}>Suivant</button>
           <span class="pill">Aller √† <input id="jump" class="input" style="width:70px" type="number" min="1" max="${pages}" value="${state.page}"> / ${pages}</span>`;
  paginationEl.innerHTML = html;

  // Bind add buttons
  servicesEl.querySelectorAll('.addBtn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const id = Number(btn.dataset.id);
      const card = btn.closest('.svc');
      const qty = Number(card.querySelector('.qty').value||0);
      addToCart(id, qty);
    }, {passive:true});
  });

  // Bind pager
  paginationEl.querySelectorAll('.page-btn').forEach(b=>{
    b.addEventListener('click', ()=>{
      if (b.dataset.page){ state.page = Number(b.dataset.page); render(); window.scrollTo({top:0, behavior:'smooth'}); }
      if (b.dataset.nav==='prev' && state.page>1){ state.page--; render(); window.scrollTo({top:0, behavior:'smooth'}); }
      if (b.dataset.nav==='next'){ const pages = Math.ceil(applyFilters().length/state.per); if (state.page<pages){ state.page++; render(); window.scrollTo({top:0, behavior:'smooth'}); } }
    }, {passive:true});
  });
  const jump = document.getElementById('jump');
  if (jump){
    jump.addEventListener('change', ()=>{
      const pages = Math.ceil(applyFilters().length/state.per);
      let v = Math.max(1, Math.min(pages, Number(jump.value)||1));
      state.page = v; render(); window.scrollTo({top:0, behavior:'smooth'});
    });
  }
}
function convert(pricePerK){
  return pricePerK * currencyRates[state.cur];
}

/* =========================
   Cart
   ========================= */
let CART = [];
function addToCart(id, qty){
  const svc = SERVICES.find(s=>s.id===id);
  if (!svc) return;
  const q = Math.max(svc.min, Math.min(svc.max, qty||svc.min));
  const existing = CART.find(i=>i.id===id);
  if (existing){ existing.qty += q; } else { CART.push({id, qty:q}); }
  updateCartBadge();
  showToast("Ajout√© au panier");
}
function updateCartBadge(){
  const n = CART.reduce((a,b)=>a+b.qty,0);
  cartCount.textContent = `(${n})`;
}
function cartTotalEUR(){
  let sum = 0;
  for (const item of CART){
    const svc = SERVICES.find(s=>s.id===item.id);
    const unitsK = item.qty / 1000;
    sum += svc.pricePerK * unitsK;
  }
  return sum; // EUR base
}
function renderCart(){
  const cur = state.cur;
  const rate = currencyRates[cur];
  const wrap = document.getElementById('cartItems');
  if (CART.length===0){ wrap.innerHTML = `<p class="muted">Votre panier est vide.</p>`; }
  else{
    wrap.innerHTML = `
      <div class="cart-row muted" style="font-weight:700; border-bottom:1px solid rgba(148,163,184,.25)">
        <div>Service</div><div>Plateforme</div><div>Quantit√©</div><div>Prix</div><div></div>
      </div>
      ${CART.map(item=>{
        const svc = SERVICES.find(s=>s.id===item.id);
        const price = svc.pricePerK * (item.qty/1000) * rate;
        return `
          <div class="cart-row">
            <div>${svc.name}</div>
            <div class="muted">${svc.platform}</div>
            <div><input type="number" min="${svc.min}" max="${svc.max}" value="${item.qty}" data-id="${item.id}" class="input" style="width:110px"></div>
            <div>${fmt(price)} ${cur}</div>
            <div><button class="btn icon-btn" data-remove="${item.id}">üóëÔ∏è</button></div>
          </div>
        `;
      }).join('')}
    `;
    // bind qty updates & remove
    wrap.querySelectorAll('input[type=number]').forEach(inp=>{
      inp.addEventListener('change', ()=>{
        const id = Number(inp.dataset.id);
        const svc = SERVICES.find(s=>s.id===id);
        let v = Math.max(svc.min, Math.min(svc.max, Number(inp.value)||svc.min));
        const row = CART.find(i=>i.id===id); row.qty = v;
        document.getElementById('cartTotal').textContent = fmt(cartTotalEUR()*currencyRates[state.cur]);
      });
    });
    wrap.querySelectorAll('[data-remove]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = Number(btn.dataset.remove);
        CART = CART.filter(i=>i.id!==id);
        renderCart(); updateCartBadge();
      });
    });
  }
  document.getElementById('cartCur').textContent = cur;
  document.getElementById('currencyLabel').textContent = cur;
  document.getElementById('cartTotal').textContent = fmt(cartTotalEUR()*rate);
}

function openPaypalCheckout(){
  if (CART.length===0){ showToast("Panier vide"); return; }
  // total en EUR pour PayPal.me
  const totalEUR = cartTotalEUR();
  const amount = Math.max(1, Math.round(totalEUR*100)/100); // min 1‚Ç¨
  const note = encodeURIComponent("PowerBots360 Commande");
  // Redirection PayPal.me
  const url = `https://www.paypal.me/BotMarketPlus/${amount}?note=${note}`;
  window.location.href = url;
}

/* =========================
   Routing (sections)
   ========================= */
function showHome(){ home.classList.remove('hidden'); catalogSec.classList.add('hidden'); }
function showCatalog(){ home.classList.add('hidden'); catalogSec.classList.remove('hidden'); render(); }

homeBtn.addEventListener('click', showHome, {passive:true});
catalogBtn.addEventListener('click', showCatalog, {passive:true});
goToCatalog?.addEventListener('click', showCatalog, {passive:true});

document.querySelectorAll('[data-quick]').forEach(b=>{
  b.addEventListener('click', ()=>{
    state.p = b.dataset.quick; platform.value = state.p; state.page=1; showCatalog();
  }, {passive:true});
});

/* =========================
   Filters
   ========================= */
search.addEventListener('input', ()=>{ state.q = search.value.trim(); state.page=1; render(); }, {passive:true});
platform.addEventListener('change', ()=>{ state.p = platform.value; state.page=1; render(); }, {passive:true});
country.addEventListener('change', ()=>{ state.c = country.value; state.page=1; render(); }, {passive:true});
perPage.addEventListener('change', ()=>{ state.per = Number(perPage.value); state.page=1; render(); }, {passive:true});
document.getElementById('resetFilters').addEventListener('click', ()=>{
  search.value=""; platform.value=""; country.value=""; state.q=""; state.p=""; state.c=""; state.page=1; render();
}, {passive:true});

currencySel.addEventListener('change', ()=>{ state.cur = currencySel.value; renderCart(); render(); }, {passive:true});

/* =========================
   Cart UI
   ========================= */
cartBtn.addEventListener('click', ()=>{ renderCart(); openModal(cartModal); }, {passive:true});
checkoutBtn.addEventListener('click', openPaypalCheckout, {passive:true});

/* =========================
   Auth flows
   ========================= */
loginBtn.addEventListener('click', ()=>openModal(authModal), {passive:true});

if (auth){
  onAuthStateChanged(auth, (user)=>{
    if (user){
      userInfo.classList.remove('hidden');
      loginBtn.classList.add('hidden');
      logoutBtn.classList.remove('hidden');
      userEmail.textContent = user.email || "Compte";
      avatar.textContent = (user.email||"")[0]?.toUpperCase() || "üòÄ";
      showToast("Connect√©");
    }else{
      userInfo.classList.add('hidden');
      loginBtn.classList.remove('hidden');
      logoutBtn.classList.add('hidden');
    }
  });
  doLogin.addEventListener('click', async ()=>{
    try{
      await signInWithEmailAndPassword(auth, authEmail.value, authPass.value);
      closeModal(authModal);
    }catch(e){ showToast("√âchec connexion"); console.warn(e); }
  });
  doRegister.addEventListener('click', async ()=>{
    try{
      await createUserWithEmailAndPassword(auth, authEmail.value, authPass.value);
      closeModal(authModal);
      showToast("Compte cr√©√©");
    }catch(e){ showToast("√âchec inscription"); console.warn(e); }
  });
  doGoogle.addEventListener('click', async ()=>{
    try{
      const provider = new GoogleAuthProvider();
      await signInWithPopup(auth, provider);
      closeModal(authModal);
    }catch(e){ showToast("Google: autoriser la fen√™tre"); console.warn(e); }
  });
  logoutBtn.addEventListener('click', async ()=>{ try{ await signOut(auth); showToast("D√©connect√©"); }catch(e){ console.warn(e);} }, {passive:true});
}else{
  // Si Firebase n'a pas pu s'initialiser (cl√© manquante) :
  loginBtn.addEventListener('click', ()=>showToast("Auth d√©sactiv√©e (config Firebase manquante)"), {passive:true});
}

/* =========================
   Boost UX mobile (tout r√©agit)
   ========================= */
document.addEventListener('touchstart', ()=>{}, {passive:true});

/* =========================
   Start
   ========================= */
showHome(); // Accueil par d√©faut
</script>
</body>
</html>
