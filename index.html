<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>PowerBots360 ‚Äî Services pros de croissance & conformit√©</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<meta name="theme-color" content="#0b1020">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b1020;
    --glass:rgba(10,14,25,.66);
    --glass-strong:rgba(10,14,25,.90);
    --stroke:rgba(255,255,255,.14);
    --text:#e5e7eb;
    --muted:#94a3b8;
    --brand:#22d3ee;
    --ok:#22c55e;
    --warn:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
    color:var(--text);
    background:var(--bg) center/cover fixed no-repeat;
  }
  .overlay{position:fixed;inset:0;background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.35) 40%, rgba(0,0,0,.65));pointer-events:none;z-index:0}
  a{color:inherit;text-decoration:none}
  button,select,input,textarea{font:inherit}
  .container{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:16px}
  .card{background:rgba(255,255,255,.10);backdrop-filter:blur(10px);border:1px solid var(--stroke);border-radius:16px;padding:16px;box-shadow:0 12px 36px rgba(0,0,0,.35)}
  header{position:sticky;top:0;z-index:30;backdrop-filter:blur(10px)}
  .bar{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--stroke);background:var(--glass-strong)}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:34px;height:34px;border-radius:10px;background:radial-gradient(circle at 30% 30%, #22d3ee, #2563eb 60%, #0ea5e9);box-shadow:0 0 16px rgba(56,189,248,.45), inset 0 0 10px rgba(59,130,246,.5)}
  .brand h1{margin:0;font-size:18px;letter-spacing:.3px}
  .nav{display:flex;align-items:center;gap:8px}
  .btn{border:1px solid var(--stroke);background:rgba(255,255,255,.10);color:var(--text);padding:9px 14px;border-radius:12px;cursor:pointer;transition:.2s;line-height:1}
  .btn:hover{background:rgba(255,255,255,.18)}
  .btn-ghost{background:transparent}
  .btn-primary{background:linear-gradient(90deg,#22c55e,#16a34a);border:none}
  .chip{padding:4px 8px;border-radius:999px;border:1px solid var(--stroke);background:rgba(255,255,255,.08);font-size:12px}
  .hamb{display:none}
  .drawer{position:fixed;inset:0 0 0 auto;width:88%;max-width:420px;background:var(--glass-strong);border-left:1px solid var(--stroke);transform:translateX(100%);transition:.25s;z-index:40;padding:16px;display:flex;flex-direction:column;gap:12px}
  .drawer.open{transform:none}
  .drawer .group{display:flex;flex-direction:column;gap:8px}
  .drawer .title{font-weight:600;opacity:.9}
  section{margin:14px 0}
  .hidden{display:none}
  .hero{display:grid;gap:14px}
  .hero h2{margin:0;font-size:26px}
  .lead{color:#cbd5e1}
  .pillbar{display:flex;gap:8px;flex-wrap:wrap}
  .pill{background:rgba(0,0,0,.45);border:1px solid var(--stroke);border-radius:999px;padding:6px 10px;font-size:12px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  .field{display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--stroke);border-radius:12px;background:rgba(255,255,255,.08)}
  .field input,.field select{all:unset;color:var(--text)}
  .field input::placeholder{color:#cbd5e1}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
  .card-sm{padding:12px;border-radius:14px;background:var(--glass);border:1px solid var(--stroke)}
  .card-sm:hover{transform:translateY(-2px);transition:.18s;box-shadow:0 10px 28px rgba(0,0,0,.28)}
  .title{margin:0 0 6px;font-size:16px}
  .meta{display:flex;gap:8px;flex-wrap:wrap}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
  .muted{color:var(--muted);font-size:13px}
  .price{color:#86efac;font-weight:700}
  .old{color:#94a3b8;text-decoration:line-through;margin-left:6px;font-weight:500}
  .pager{display:flex;align-items:center;gap:8px;justify-content:center;margin-top:10px;flex-wrap:wrap}
  .pager input{width:70px;text-align:center;border:1px solid var(--stroke);background:rgba(255,255,255,.08);border-radius:10px;padding:8px;color:var(--text)}
  .cart{position:fixed;right:0;top:0;height:100%;width:92%;max-width:420px;background:var(--glass-strong);border-left:1px solid var(--stroke);transform:translateX(100%);transition:.25s;z-index:45;padding:16px 14px;overflow:auto}
  .cart.open{transform:none}
  .line{display:flex;justify-content:space-between;gap:10px;margin:6px 0}
  .divider{height:1px;background:var(--stroke);margin:10px 0}
  .total{font-size:18px;font-weight:800}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:50}
  .modal.open{display:flex}
  form.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  form.grid textarea{grid-column:1/-1}
  form .input{padding:10px;border:1px solid var(--stroke);border-radius:12px;background:rgba(255,255,255,.08);color:var(--text)}
  form .input::placeholder{color:#cbd5e1}
  footer{text-align:center;color:var(--muted);padding:28px}
  .langbox{position:relative}
  .langmenu{position:absolute;top:110%;right:0;background:var(--glass-strong);border:1px solid var(--stroke);border-radius:10px;padding:6px;display:none}
  .langmenu.open{display:block}
  .langmenu button{display:block;width:100%;text-align:left;margin:4px 0}
  @media (min-width:880px){ .hero{grid-template-columns:1.1fr .9fr} }
  @media (max-width:960px){ .hamb{display:inline-flex}.nav .btn, .nav select{display:none} }
</style>
</head>
<body>
<div class="overlay"></div>

<header>
  <div class="bar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <h1>PowerBots360</h1>
      <span class="chip" id="badgeVer">v2.0</span>
    </div>
    <div class="nav">
      <button class="btn hamb" id="openDrawer" aria-label="Ouvrir le menu">‚ò∞</button>
      <button class="btn" data-goto="home">Accueil</button>
      <button class="btn" data-goto="catalogue">Catalogue</button>
      <button class="btn" data-goto="contact">Contact</button>
      <button class="btn" data-goto="faq">FAQ</button>
      <button class="btn" data-goto="legal">L√©gal</button>
      <select class="btn" id="currency">
        <option value="EUR" selected>‚Ç¨ EUR</option>
        <option value="USD">$ USD</option>
        <option value="GBP">¬£ GBP</option>
      </select>
      <div class="langbox">
        <button class="btn" id="langBtn">FR ‚ñæ</button>
        <div class="langmenu" id="langMenu">
          <button class="btn" data-lang="fr">Fran√ßais</button>
          <button class="btn" data-lang="en">English</button>
        </div>
      </div>
      <button class="btn" id="authOpen">Connexion</button>
      <button class="btn btn-primary" id="cartOpen">Panier (<span id="cartCount">0</span>)</button>
    </div>
  </div>

  <nav class="drawer" id="drawer" aria-label="Menu lat√©ral">
    <div class="row"><strong>Menu</strong><button class="btn" id="drawerClose">Fermer</button></div>
    <div class="group">
      <span class="title">Navigation</span>
      <button class="btn" data-goto="home">Accueil</button>
      <button class="btn" data-goto="catalogue">Catalogue</button>
      <button class="btn" data-goto="contact">Contact</button>
      <button class="btn" data-goto="faq">FAQ</button>
      <button class="btn" data-goto="legal">L√©gal</button>
    </div>
    <div class="group">
      <span class="title">Compte</span>
      <button class="btn" id="drawerAuth">Connexion / Inscription</button>
      <button class="btn btn-primary" id="drawerCart">Ouvrir le panier</button>
    </div>
    <div class="group">
      <span class="title">Pr√©f√©rences</span>
      <div class="row">
        <select class="btn" id="currencyDrawer" style="flex:1">
          <option value="EUR" selected>‚Ç¨ EUR</option>
          <option value="USD">$ USD</option>
          <option value="GBP">¬£ GBP</option>
        </select>
        <select class="btn" id="langDrawer" style="flex:1">
          <option value="fr" selected>Fran√ßais</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>
  </nav>
</header>

<main class="container">
  <section id="home" class="card">
    <div class="hero">
      <div>
        <h2 id="heroTitle">Services pros : croissance responsable, conformit√© & analytics.</h2>
        <p class="lead" id="heroSubtitle">Tous r√©seaux (incl. OnlyFans, MYM, Kick), fiches d√©taill√©es, panier s√©curis√©, PayPal. Multi-langues et devises.</p>
        <div class="pillbar" role="list">
          <span class="pill">‚úÖ Paiement PayPal</span>
          <span class="pill">üõ°Ô∏è Audit conformit√© (BotWatch)</span>
          <span class="pill">üìà Conseils ads & analytics</span>
          <span class="pill">üë• Onboarding cr√©ateur (OF/MYM)</span>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn btn-primary" data-goto="catalogue">Voir le catalogue</button>
          <button class="btn" id="forceRefresh">Forcer l‚Äôactualisation</button>
        </div>
      </div>
      <div class="card" style="background:var(--glass);border-color:var(--stroke)">
        <div class="row"><strong>Espace client</strong><span class="muted">D√©mo locale (aucune donn√©e envoy√©e)</span></div>
        <div class="divider"></div>
        <div class="row" style="gap:8px;flex-wrap:wrap">
          <input id="authEmail" class="btn" placeholder="email@exemple.com" style="flex:1;min-width:220px;background:rgba(255,255,255,.08)">
          <input id="authPass" class="btn" type="password" placeholder="Mot de passe (min 6)" style="flex:1;min-width:180px;background:rgba(255,255,255,.08)">
          <button class="btn" id="signupBtn">Cr√©er compte</button>
          <button class="btn" id="signinBtn">Se connecter</button>
          <button class="btn btn-ghost" id="signoutBtn">Se d√©connecter</button>
        </div>
        <div id="authState" class="muted" style="margin-top:8px">Statut : invit√©</div>
      </div>
    </div>
  </section>

  <section id="catalogue" class="card hidden" aria-live="polite">
    <div class="row" style="align-items:stretch">
      <div class="field" style="flex:1"><span>üîé</span><input id="q" placeholder="Rechercher (ex. MYM, OnlyFans, ads, analytics)‚Ä¶" aria-label="Rechercher"></div>
      <div class="field"><span>üè∑Ô∏è</span>
        <select id="platform" aria-label="Plateforme">
          <option value="all">Toutes plateformes</option>
        </select>
      </div>
      <div class="field"><span>üåç</span>
        <select id="country" aria-label="Pays">
          <option value="all">Tous pays</option>
        </select>
      </div>
      <div class="field"><span>‚öôÔ∏è</span>
        <select id="sort" aria-label="Tri">
          <option value="pop">Populaires</option>
          <option value="priceAsc">Prix ‚Üë</option>
          <option value="priceDesc">Prix ‚Üì</option>
        </select>
      </div>
    </div>

    <div id="grid" class="grid"></div>

    <div class="pager">
      <button class="btn" id="prevPage">‚óÄ Pr√©c√©dent</button>
      <span class="muted">Page <span id="pageNow">1</span> / <span id="pageMax">1</span></span>
      <button class="btn" id="nextPage">Suivant ‚ñ∂</button>
      <input id="gotoPage" class="input" placeholder="Aller √†‚Ä¶">
      <button class="btn" id="gotoBtn">Aller</button>
    </div>
  </section>

  <section id="contact" class="card hidden">
    <h3>Contact</h3>
    <p class="muted">Besoin d‚Äôaide ? R√©ponse rapide 7j/7.</p>
    <form id="contactForm" class="grid">
      <input class="input" name="name" placeholder="Nom complet" required>
      <input class="input" name="email" type="email" placeholder="Email" required>
      <textarea class="input" name="msg" rows="4" placeholder="Votre message‚Ä¶" required></textarea>
      <button class="btn btn-primary" type="submit">Envoyer</button>
    </form>
    <p id="contactOk" class="muted" style="display:none;margin-top:8px">Merci ! Message envoy√© (simulation).</p>
  </section>

  <section id="faq" class="card hidden">
    <h3>FAQ</h3>
    <details open>
      <summary>Quels services proposez-vous exactement ?</summary>
      <p class="muted">Conseils publicitaires, optimisation de contenu, analytics, mod√©ration et conformit√© (audit ‚ÄúBotWatch‚Äù non-automatis√©), onboarding cr√©ateur (OnlyFans/MYM), et support campagne ‚Äî jamais de faux engagement ni de signalement abusif.</p>
    </details>
    <details>
      <summary>Politique de remboursement</summary>
      <p class="muted">Si une prestation n‚Äôa pas d√©marr√© dans le d√©lai annonc√©, contactez-nous sous 72h pour ajustement, relance ou remboursement selon le cas.</p>
    </details>
    <details>
      <summary>Respect des r√®gles des plateformes</summary>
      <p class="muted">Nos prestations sont con√ßues pour respecter les CGU et √©viter les risques de restriction. Nous ne proposons pas d‚Äôautomatisation nuisible.</p>
    </details>
  </section>

  <section id="legal" class="card hidden">
    <h3>Mentions l√©gales & Conditions</h3>
    <details open><summary>Mentions l√©gales</summary>
      <p class="muted">PowerBots360 ‚Äî Contact : support@powerbots360.com ‚Äî Prestations num√©riques & conseil.</p>
    </details>
    <details><summary>CGU/CGV</summary>
      <p class="muted">D√©lais indicatifs. Pas de promesse de r√©sultat. Respect strict des CGU des plateformes.</p>
    </details>
    <details><summary>Confidentialit√©</summary>
      <p class="muted">Cookies techniques uniquement. Aucune revente de donn√©es. Suppression sur demande.</p>
    </details>
  </section>
</main>

<aside class="cart" id="cart" aria-label="Panier">
  <div class="row"><h3 style="margin:0">Panier</h3><button class="btn" id="cartClose">Fermer</button></div>
  <div class="divider"></div>
  <div id="cartItems"></div>
  <div class="divider"></div>
  <div class="line"><span>Sous-total</span><span id="subTotal">‚Ç¨ 0.00</span></div>
  <div class="line"><span>Remise</span><span id="discount">‚Ç¨ 0.00</span></div>
  <div class="line"><span>Devise</span><span id="currencyView">EUR</span></div>
  <div class="total line"><span>Total</span><span id="grandTotal">‚Ç¨ 0.00</span></div>
  <div class="divider"></div>
  <button class="btn btn-primary" id="checkout">Payer avec PayPal</button>
</aside>

<div class="modal" id="productModal">
  <div class="card" style="max-width:560px;width:92%">
    <div class="row">
      <h3 id="pmTitle" style="margin:0"></h3>
      <button class="btn" id="pmClose">‚úï</button>
    </div>
    <div class="muted" id="pmSubtitle" style="margin:6px 0 10px"></div>
    <div class="row">
      <div><span class="chip" id="pmPlatform"></span> <span class="chip" id="pmCountry"></span> <span class="chip" id="pmTier"></span></div>
      <div class="price" id="pmPrice"></div>
    </div>
    <p id="pmDesc" class="muted" style="margin-top:8px"></p>
    <div class="row" style="margin-top:8px">
      <input id="pmQty" type="number" min="1" step="1" value="1" style="all:unset;width:90px;text-align:center;background:rgba(255,255,255,.08);padding:8px;border-radius:10px;border:1px solid var(--stroke)">
      <button class="btn btn-primary" id="pmAdd">Ajouter au panier</button>
    </div>
  </div>
</div>

<footer>
  <div>¬© <span id="year"></span> PowerBots360 ‚Äî Tous droits r√©serv√©s.</div>
  <div style="margin-top:8px"><button class="btn" id="hardReload">Forcer l‚Äôactualisation (anti-cache)</button></div>
</footer>

<script>
/* ====== STATE ====== */
const state = {
  ver: 20, // incr√©mente si GitHub montre encore l'ancien site
  lang: 'fr',
  currency: 'EUR',
  rate: { EUR:1, USD:1.08, GBP:0.85 },
  platforms: ["TikTok","Instagram","YouTube","Facebook","X/Twitter","Snapchat","Twitch","Reddit","LinkedIn","Telegram","Spotify","Discord","OnlyFans","MYM","Kick"],
  countries: [
    {code:"FR",flag:"üá´üá∑",name:"France"},{code:"US",flag:"üá∫üá∏",name:"√âtats-Unis"},{code:"BR",flag:"üáßüá∑",name:"Br√©sil"},
    {code:"IN",flag:"üáÆüá≥",name:"Inde"},{code:"TR",flag:"üáπüá∑",name:"Turquie"},{code:"MX",flag:"üá≤üáΩ",name:"Mexique"},
    {code:"DE",flag:"üá©üá™",name:"Allemagne"},{code:"GB",flag:"üá¨üáß",name:"Royaume-Uni"},{code:"ES",flag:"üá™üá∏",name:"Espagne"},
    {code:"IT",flag:"üáÆüáπ",name:"Italie"},{code:"JP",flag:"üáØüáµ",name:"Japon"},{code:"CN",flag:"üá®üá≥",name:"Chine"}
  ],
  tiers:[
    {key:"Essential", label:"Essentiel", note:"Atelier de base"},
    {key:"Advanced",  label:"Avanc√©",    note:"Approfondi"},
    {key:"Premium",   label:"Premium",   note:"Accompagnement continu"},
    {key:"Ultimate",  label:"Ultime",    note:"Priorit√© & SLA"}
  ],
  catalog: [],
  cart: [],
  pageNow:1, pageSize:30,
  sort:"pop", q:"", pf:"all", cc:"all",
};
const PAYPAL_ME_BASE = "https://www.paypal.me/BotMarketPlus";

/* ====== UTILS ====== */
const el=(q)=>document.querySelector(q);
const els=(q)=>document.querySelectorAll(q);
const money=(eur,cur=state.currency)=>{ const r=state.rate[cur]||1; const v=(cur==='EUR')?eur:eur*r; const sym=cur==='EUR'?'‚Ç¨':cur==='USD'?'$':'¬£'; return `${sym} ${v.toFixed(2)}`; };
const clamp=(v,min,max)=>Math.min(Math.max(v,min),max);
const flagOf=(cc)=> (state.countries.find(c=>c.code===cc)||{}).flag || "üåç";

/* ====== NAV ====== */
function show(id){ for(const s of els('main section')) s.classList.add('hidden'); el('#'+id).classList.remove('hidden'); el('#drawer').classList.remove('open'); }
els('[data-goto]').forEach(b=>b.addEventListener('click',()=>show(b.dataset.goto)));
el('#openDrawer').onclick=()=>el('#drawer').classList.add('open');
el('#drawerClose').onclick=()=>el('#drawer').classList.remove('open');
el('#drawerAuth').onclick=()=>{ el('#drawer').classList.remove('open'); openAuth(); };
el('#drawerCart').onclick=()=>{ el('#drawer').classList.remove('open'); el('#cart').classList.add('open'); };

/* ====== LANG ====== */
const langBtn = el('#langBtn'); const langMenu = el('#langMenu');
langBtn.onclick=()=>langMenu.classList.toggle('open');
langMenu.querySelectorAll('button').forEach(b=>b.onclick=()=>setLang(b.dataset.lang));
el('#langDrawer').onchange=(e)=>setLang(e.target.value);
function setLang(l){
  state.lang=l; langBtn.textContent=(l==='fr'?'FR':'EN')+' ‚ñæ'; el('#langDrawer').value=l;
  const fr=(en,fr)=> l==='fr'? fr : en;
  el('#heroTitle').textContent=fr('Professional services: responsible growth, compliance & analytics.','Services pros : croissance responsable, conformit√© & analytics.');
  el('#heroSubtitle').textContent=fr('All platforms (incl. OnlyFans, MYM, Kick), detailed sheets, secure cart, PayPal.','Tous r√©seaux (incl. OnlyFans, MYM, Kick), fiches d√©taill√©es, panier s√©curis√©, PayPal.');
}

/* ====== CURRENCY ====== */
function setCurrency(val){ state.currency=val; el('#currency').value=val; el('#currencyDrawer').value=val; render(); }
el('#currency').onchange=(e)=> setCurrency(e.target.value);
el('#currencyDrawer').onchange=(e)=> setCurrency(e.target.value);

/* ====== SEARCH (fautes & alias) ====== */
const aliases = {
  "mime":"MYM","mym":"MYM","only fans":"OnlyFans","of":"OnlyFans","twitter":"X/Twitter","x":"X/Twitter",
  "yt":"YouTube","ig":"Instagram","fb":"Facebook","kik":"Kick","tiktok":"TikTok"
};
function normalizeQuery(q){
  q=q.toLowerCase().trim();
  if(aliases[q]) return aliases[q];
  // remplace alias dans phrase
  for(const k in aliases){ q=q.replace(new RegExp(`\\b${k}\\b`,'g'), aliases[k]); }
  return q;
}

/* ====== CATALOG (√©thique) ====== */
const ServiceKinds = [
  {k:"Audit conformit√©", base:25, desc:"Revue CGU & risques, recommandations concr√®tes."},
  {k:"Conseil Ads", base:35, desc:"Structure campagnes publicitaires (Meta/Google/TikTok) & ciblages."},
  {k:"Optimisation contenu", base:22, desc:"Titres, visuels, rythme, calendrier √©ditorial."},
  {k:"Analytics & reporting", base:28, desc:"Mise en place m√©triques, dashboards & suivi KPI."},
  {k:"Mod√©ration & communaut√©", base:24, desc:"Param√©trage outils, guidelines et r√©ponse aux membres."},
  {k:"Onboarding cr√©ateur", base:30, desc:"Paywalls, pricing, bundles (OnlyFans/MYM), bonnes pratiques."},
  {k:"BotWatch (audit manuel)", base:26, desc:"Audit anti-risques et pr√©vention des abus (sans automatisation)."}
];
function tierNote(t){return t==="Essentiel"?"(atelier 60‚Äì90 min)":
                           t==="Avanc√©"?"(atelier + plan d‚Äôaction)":
                           t==="Premium"?"(suivi 2‚Äì4 semaines)":
                           "(priorit√© + SLA & coaching)";}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

function buildCatalog(){
  const items=[]; let id=1;
  for(const pf of state.platforms){
    // 2 pays / servicekind / tier pour vari√©t√©
    for(const sk of ServiceKinds){
      for(const t of state.tiers){
        const picks = shuffle([...state.countries]).slice(0,2);
        for(const cc of picks){
          const price = sk.base * (t.key==="Essential"?1 : t.key==="Advanced"?1.25 : t.key==="Premium"?1.6 : 2.1);
          items.push({
            id:id++,
            platform:pf, kind:sk.k, tier:t.label,
            title:`${pf} ‚Äî ${sk.k} ¬∑ ${t.label}`,
            priceEUR:+price.toFixed(2),
            oldEUR: Math.random()<.18 ? +(price*1.18).toFixed(2) : null,
            country:cc.code,
            popular: Math.random()<.45,
            speed:["Session","Sprint","Programme"][Math.floor(Math.random()*3)],
            desc: sk.desc+" "+tierNote(t.label)
          });
        }
      }
    }
  }
  // Garantie : ‚â• 12 services par plateforme
  const minPerPf = 12;
  for(const pf of state.platforms){
    const count = items.filter(i=>i.platform===pf).length;
    if(count<minPerPf){
      for(let n=count; n<minPerPf; n++){
        items.push({
          id:id++, platform:pf, kind:"Pack d√©couverte", tier:"Essentiel",
          title:`${pf} ‚Äî Pack d√©couverte`,
          priceEUR:19.00, oldEUR:null, country:"FR", popular:true, speed:"Session",
          desc:"Diagnostic express + feuille de route 7 jours."
        });
      }
    }
  }
  // Limite ~ 28 pages de 30 = 840
  state.catalog = items.slice(0, 30*28);
}

/* ====== FILTERS / RENDER ====== */
const platformSel=el('#platform'), countrySel=el('#country'), sortSel=el('#sort'), grid=el('#grid');
function seedFilters(){
  platformSel.innerHTML = `<option value="all">Toutes plateformes</option>` + state.platforms.map(p=>`<option value="${p}">${p}</option>`).join('');
  countrySel.innerHTML = `<option value="all">Tous pays</option>` + state.countries.map(c=>`<option value="${c.code}">${c.flag} ${c.name}</option>`).join('');
}
function filtered(){
  const raw = (state.q||""); const q = normalizeQuery(raw);
  let L = state.catalog.filter(s=>{
    const okP = state.pf==='all' || s.platform===state.pf;
    const okC = state.cc==='all' || s.country===state.cc;
    const okQ = !q || s.title.toLowerCase().includes(q.toLowerCase()) || s.platform.toLowerCase().includes(q.toLowerCase()) || s.kind.toLowerCase().includes(q.toLowerCase());
    return okP && okC && okQ;
  });
  if(state.sort==='priceAsc') L.sort((a,b)=>a.priceEUR-b.priceEUR);
  if(state.sort==='priceDesc') L.sort((a,b)=>b.priceEUR-a.priceEUR);
  if(state.sort==='pop') L.sort((a,b)=>(b.popular|0)-(a.popular|0));
  return L;
}
function priceFmt(eur){ return money(eur, state.currency); }
function render(){
  const list = filtered();
  const pages = Math.max(1, Math.ceil(list.length/state.pageSize));
  state.pageNow = clamp(state.pageNow, 1, pages);
  el('#pageNow').textContent = state.pageNow; el('#pageMax').textContent = pages;

  const start = (state.pageNow-1)*state.pageSize;
  const slice = list.slice(start, start+state.pageSize);

  grid.innerHTML = slice.map(item=>{
    const old = item.oldEUR ? `<span class="old">${priceFmt(item.oldEUR)}</span>` : '';
    return `
    <article class="card-sm" data-id="${item.id}">
      <h4 class="title">${item.title}</h4>
      <div class="meta">
        <span class="chip">${item.platform}</span>
        <span class="chip">${item.kind}</span>
        <span class="chip">${item.tier}</span>
        <span class="chip"><span>${flagOf(item.country)}</span> ${item.country}</span>
      </div>
      <p class="muted" title="${item.desc}">${item.desc.length>92? item.desc.slice(0,91)+'‚Ä¶' : item.desc}</p>
      <div class="row">
        <div><span class="price">${priceFmt(item.priceEUR)}</span>${old}</div>
        <button class="btn" data-act="details">D√©tails</button>
      </div>
    </article>`;
  }).join('');

  el('#currencyView').textContent = state.currency;
  bumpCart();
}

/* ====== EVENTS ====== */
el('#q').addEventListener('input', e=>{ state.q=e.target.value; state.pageNow=1; render(); });
platformSel.onchange = e=>{ state.pf=e.target.value; state.pageNow=1; render(); };
countrySel.onchange  = e=>{ state.cc=e.target.value; state.pageNow=1; render(); };
sortSel.onchange     = e=>{ state.sort=e.target.value; state.pageNow=1; render(); };
el('#prevPage').onclick=()=>{ state.pageNow--; render(); };
el('#nextPage').onclick=()=>{ state.pageNow++; render(); };
el('#gotoBtn').onclick = ()=>{ const p=parseInt(el('#gotoPage').value||'1',10); if(!isNaN(p)){ state.pageNow=p; render(); }};

/* ====== PRODUCT MODAL ====== */
const pModal = el('#productModal');
grid.addEventListener('click', (e)=>{
  const btn = e.target.closest('[data-act="details"]'); if(!btn) return;
  const card = e.target.closest('article'); const id = +card.dataset.id;
  const it = state.catalog.find(x=>x.id===id); if(!it) return;
  openProduct(it);
});
function openProduct(it){
  el('#pmTitle').textContent = it.title;
  el('#pmSubtitle').textContent = it.kind + " ‚Ä¢ " + it.tier;
  el('#pmPlatform').textContent = it.platform;
  el('#pmCountry').textContent  = flagOf(it.country) + " " + it.country;
  el('#pmTier').textContent     = it.tier;
  el('#pmPrice').textContent    = priceFmt(it.priceEUR);
  el('#pmDesc').textContent     = it.desc;
  const inp = el('#pmQty'); inp.min = 1; inp.max = 100; inp.step = 1; inp.value = 1;
  el('#pmAdd').onclick=()=>{ addToCart(it, +inp.value); pModal.classList.remove('open'); };
  pModal.classList.add('open');
}
el('#pmClose').onclick=()=>pModal.classList.remove('open');
pModal.addEventListener('click',(e)=>{ if(e.target===pModal) pModal.classList.remove('open'); });

/* ====== CART ====== */
const cart = el('#cart'), cartCount=el('#cartCount');
el('#cartOpen').onclick=()=>cart.classList.add('open');
el('#cartClose').onclick=()=>cart.classList.remove('open');

function addToCart(item, q){
  const found = state.cart.find(c=>c.id===item.id);
  if(found) found.qty += q; else state.cart.push({id:item.id, title:item.title, priceEUR:item.priceEUR, qty:q});
  renderCart();
}
function bumpCart(){ cartCount.textContent = state.cart.reduce((a,b)=>a+b.qty,0); }
function renderCart(){
  const wrap = el('#cartItems'); wrap.innerHTML='';
  let subEUR=0;
  for(const c of state.cart){
    subEUR += c.priceEUR * c.qty;
    const line = document.createElement('div'); line.className='line';
    line.innerHTML = `
      <div>
        <div><strong>${c.title}</strong></div>
        <div class="muted">${c.qty} unit√©(s) ¬∑ ‚Ç¨ ${(c.priceEUR).toFixed(2)}</div>
      </div>
      <div><button class="btn" data-rm="${c.id}">‚úï</button></div>`;
    wrap.appendChild(line);
  }
  wrap.querySelectorAll('[data-rm]').forEach(b=>b.onclick=()=>{
    state.cart = state.cart.filter(x=>x.id!==+b.dataset.rm); renderCart();
  });
  const discount=0;
  el('#subTotal').textContent = money(subEUR,'EUR');
  el('#discount').textContent = money(discount,'EUR');
  el('#grandTotal').textContent = money(subEUR-discount, state.currency);
  bumpCart();
}
el('#checkout').onclick=()=>{
  if(!state.cart.length){ alert('Panier vide.'); return; }
  let sub=0; for(const c of state.cart) sub += c.priceEUR*c.qty;
  const amount = Math.max(1, +sub.toFixed(2));
  const url = `${PAYPAL_ME_BASE}/${amount}?locale.x=fr_FR`;
  window.open(url, '_blank');
};

/* ====== AUTH (d√©mo locale) ====== */
function setUser(u){ el('#authState').textContent = u? `Connect√© : ${u.email}` : 'Statut : invit√©'; el('#authOpen').textContent = u? 'Mon compte' : 'Connexion'; }
function openAuth(){ show('home'); window.scrollTo({top:0,behavior:'smooth'}); }
el('#authOpen').onclick=openAuth;
el('#signupBtn').onclick=()=>{ const e=el('#authEmail').value.trim(), p=el('#authPass').value.trim();
  if(e&&p.length>=6){ localStorage.setItem('pb_user',JSON.stringify({email:e})); setUser({email:e}); alert('Compte cr√©√©.'); } else alert('Email + mot de passe (min 6).');
};
el('#signinBtn').onclick=()=>{ const e=el('#authEmail').value.trim(), p=el('#authPass').value.trim();
  const u=JSON.parse(localStorage.getItem('pb_user')||'null'); if(u&&e===u.email&&p.length>=6){ setUser(u); alert('Connect√©.'); } else alert('Identifiants invalides.');
};
el('#signoutBtn').onclick=()=>{ localStorage.removeItem('pb_user'); setUser(null); };

/* ====== CONTACT ====== */
el('#contactForm').addEventListener('submit',e=>{
  e.preventDefault(); el('#contactOk').style.display='block'; e.target.reset();
});

/* ====== INIT ====== */
function init(){
  document.getElementById('year').textContent = new Date().getFullYear();
  el('#badgeVer').textContent = 'v2.'+state.ver;
  // fond d'√©cran (anti-cache)
  document.body.style.backgroundImage = `url("https://i.postimg.cc/qRzJKc7j/IMG-3273.jpg?v=${state.ver}")`;
  buildCatalog(); seedFilters(); render(); setUser(JSON.parse(localStorage.getItem('pb_user')||'null'));
  setLang('fr'); setCurrency('EUR');
}
init();

/* ====== A11Y & GLOBAL ====== */
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape'){ el('#cart').classList.remove('open'); el('#drawer').classList.remove('open'); el('#productModal').classList.remove('open'); }});
el('#hardReload').onclick=()=>{ state.ver++; localStorage.setItem('pb_ver', state.ver); location.reload(true); };
el('#forceRefresh').onclick=()=>{ state.ver++; localStorage.setItem('pb_ver', state.ver); location.reload(true); };
</script>
</body>
</html>
