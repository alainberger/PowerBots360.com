<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Réinitialisation du mot de passe — PowerBots360</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin:0; padding:0; }
html, body { height:100%; width:100%; font-family:'Poppins',sans-serif; overflow-x:hidden; }
body { background: linear-gradient(135deg,#A8D5BA,#D1E8FF); color:#043233; }
a { text-decoration:none; color:inherit; }
.navbar { position:fixed; top:0; left:0; width:100%; background:linear-gradient(135deg,#A8D5BA,#D1E8FF); padding:12px 18px; display:flex; align-items:center; gap:12px; z-index:1000; }
.navbar img { height:40px; }
.brand { font-weight:700; font-size:1.05rem; color:#043233; }
.reset-container { max-width:380px; margin:120px auto 40px; background:rgba(255,255,255,0.96); padding:32px 28px; border-radius:12px; box-shadow:0 8px 26px rgba(6,40,30,0.08); display:flex; flex-direction:column; gap:16px; text-align:center; }
.reset-container h2 { font-size:1.3rem; font-weight:700; margin-bottom:10px; color:#053827; }
label { display:block; font-weight:600; margin-bottom:6px; text-align:left; }
.input-wrapper { position:relative; }
.input-wrapper input { width:100%; padding:12px 12px 12px 42px; border:1px solid rgba(5,58,40,0.2); border-radius:8px; font-size:0.95rem; outline:none; transition:border 0.2s, box-shadow 0.2s; }
.input-wrapper input:focus { border-color:#053827; box-shadow:0 0 4px rgba(5,58,40,0.2); }
.leading-icon { position:absolute; left:12px; top:50%; transform:translateY(-50%); width:22px; height:22px; color:#043233; display:inline-flex; align-items:center; justify-content:center; }
.btn { background: linear-gradient(135deg,#A8D5BA,#D1E8FF); color:#043233; font-weight:600; padding:12px; border-radius:8px; cursor:pointer; transition:background .3s; border:none; margin-top:8px; }
.btn:hover { background: linear-gradient(135deg,#B0E0C2,#E0F0FF); }
.notification { position:fixed; top:70px; right:20px; background:linear-gradient(135deg,#A8D5BA,#D1E8FF); color:#043233; padding:12px 18px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.2); font-weight:600; display:none; z-index:1200; }
</style>
</head>
<body>

<header class="navbar">
  <img src="https://i.postimg.cc/vZrnmPXd/IMG-3286.png" alt="Logo PowerBots360">
  <div class="brand">PowerBots360</div>
</header>

<div class="reset-container">
  <h2>Réinitialiser votre mot de passe</h2>
  <label for="newPassword">Nouveau mot de passe</label>
  <div class="input-wrapper">
    <input type="password" id="newPassword" placeholder="Entrez votre nouveau mot de passe">
  </div>
  <label for="confirmPassword">Confirmer le mot de passe</label>
  <div class="input-wrapper">
    <input type="password" id="confirmPassword" placeholder="Confirmez le mot de passe">
  </div>
  <button class="btn" id="resetBtn">Valider</button>
</div>

<div class="notification" id="toast">Message</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getAuth, confirmPasswordReset } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyChJoeaMJlj2F-7okhrPJYw868Z1RhgMFY",
  authDomain: "powerbots360-2a163.firebaseapp.com",
  projectId: "powerbots360-2a163",
  storageBucket: "powerbots360-2a163.firebasestorage.app",
  messagingSenderId: "968053928320",
  appId: "1:968053928320:web:c51f7be039c02f2fb69165",
  measurementId: "G-TXSM0JYF1G"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const urlParams = new URLSearchParams(window.location.search);
const oobCode = urlParams.get('oobCode');

const resetBtn = document.getElementById('resetBtn');
const newPasswordInput = document.getElementById('newPassword');
const confirmPasswordInput = document.getElementById('confirmPassword');
const toast = document.getElementById('toast');

function showToast(msg){
  toast.textContent = msg;
  toast.style.display = 'block';
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>toast.style.display='none',3500);
}

resetBtn.addEventListener('click', async ()=>{
  const newPassword = newPasswordInput.value.trim();
  const confirmPassword = confirmPasswordInput.value.trim();

  if(!newPassword || !confirmPassword){
    showToast("Merci de remplir tous les champs.");
    return;
  }
  if(newPassword !== confirmPassword){
    showToast("Les mots de passe ne correspondent pas !");
    return;
  }
  if(!oobCode){
    showToast("Lien invalide ou expiré.");
    return;
  }

  try{
    await confirmPasswordReset(auth, oobCode, newPassword);
    showToast("Mot de passe réinitialisé avec succès !");
    setTimeout(()=>{ window.location.href="connexion.html"; },2500);
  }catch(error){
    showToast("Erreur : "+error.message);
    console.error(error);
  }
});
</script>

</body>
</html>
