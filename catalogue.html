<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PowerBots360 — Catégorie</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins', sans-serif; margin:0; padding:0; background:linear-gradient(135deg,#A8D5BA,#D1E8FF); color:#043233; }
header { position:fixed; top:0; left:0; width:100%; background:linear-gradient(135deg,#A8D5BA,#D1E8FF); display:flex; align-items:center; padding:12px 20px; z-index:1000; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
header img { height:40px; margin-right:10px; }
.brand { font-weight:700; font-size:1.05rem; }
main { max-width:900px; margin:100px auto 40px; padding:0 20px; }
h1{text-align:center; margin-bottom:20px;}
.catalogue-item{background:#B0E0C2; padding:15px; margin-bottom:15px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.15);}
.catalogue-item h2{margin-bottom:8px;}
.catalogue-item p{margin-bottom:5px;}
.btn-add{background:#043233; color:#fff; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; transition:0.3s;}
.btn-add:hover{background:#065959;}
#cart{background:rgba(255,255,255,0.1); padding:15px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); margin-top:20px;}
#cart h2{margin-bottom:10px;}
.cart-item{display:flex; justify-content:space-between; margin-bottom:6px;}
#btnCheckout{background:linear-gradient(135deg,#A8D5BA,#D1E8FF); color:#043233; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; margin-top:10px; transition:0.3s;}
#btnCheckout:hover{background:linear-gradient(135deg,#B0E0C2,#E0F0FF);}
a{color:#043233; text-decoration:none;}
a:hover{text-decoration:underline;}
</style>
</head>
<body>

<header>
  <img src="https://i.postimg.cc/vZrnmPXd/IMG-3286.png" alt="Logo PowerBots360">
  <div class="brand">PowerBots360</div>
</header>

<main>
<h1>Catalogue de Services</h1>

<div id="catalogue"></div>

<div id="cart">
  <h2>Panier</h2>
  <div id="cartItems">Votre panier est vide.</div>
  <button id="btnCheckout">Payer</button>
</div>

<p style="text-align:center;"><a href="index.html">← Retour à l'accueil</a></p>

<script src="https://js.stripe.com/v3/"></script>
<script>
const catalogueDiv = document.getElementById('catalogue');
const cart = [];
const cartItemsDiv = document.getElementById('cartItems');
const btnCheckout = document.getElementById('btnCheckout');

function renderCart() {
  if(cart.length===0){ cartItemsDiv.innerHTML="Votre panier est vide."; return; }
  cartItemsDiv.innerHTML='';
  cart.forEach(item=>{
    const div=document.createElement('div');
    div.className='cart-item';
    div.textContent=`${item.name} - ${item.price}€`;
    cartItemsDiv.appendChild(div);
  });
}

// Exemple temporaire (en attendant l’API Peakerr)
// Tu peux remplacer ce tableau par fetch('/api/getServices') côté serveur
const services = [
  {name:'Bot Telegram', description:'Automatisation avancée pour Telegram.', price:'19.99'},
  {name:'Bot TikTok', description:'Boost et gestion de comptes TikTok.', price:'24.99'}
];

services.forEach(service=>{
  const div = document.createElement('div');
  div.className='catalogue-item';
  div.innerHTML = `<h2>${service.name}</h2>
                   <p>${service.description}</p>
                   <p>Prix : ${service.price}€</p>`;
  const btn = document.createElement('button');
  btn.className='btn-add';
  btn.textContent='Ajouter au panier';
  btn.addEventListener('click', ()=>{
    cart.push({name:service.name, price:service.price});
    renderCart();
  });
  div.appendChild(btn);
  catalogueDiv.appendChild(div);
});

btnCheckout.addEventListener('click', async ()=>{
  if(cart.length===0){ alert("Votre panier est vide."); return; }

  try {
    const res = await fetch('/api/create-checkout-session', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ cart })
    });
    const data = await res.json();
    if(data.url) {
      window.location.href = data.url; // redirection Stripe Checkout
    } else {
      alert("Erreur lors de la création de la session de paiement.");
    }
  } catch(err) {
    console.error(err);
    alert("Erreur serveur.");
  }
});
</script>

</body>
</html>
